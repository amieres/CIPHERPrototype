(function(){"use strict";var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H;var a=clearTimeout,b=setTimeout;c=window.WebSharper=window.WebSharper||{};d=c.Control=c.Control||{};e=d.Observer=d.Observer||{};f=e.Message=e.Message||{};g=d.HotStream=d.HotStream||{};h=g.HotStream=g.HotStream||{};i=d.Observable=d.Observable||{};j=window.Microsoft=window.Microsoft||{};k=j.FSharp=j.FSharp||{};l=k.Control=k.Control||{};m=l.ObservableModule=l.ObservableModule||{};n=d.Event=d.Event||{};o=n.Event=n.Event||{};p=d.DelegateEvent=d.DelegateEvent||{};q=p.DelegateEvent=p.DelegateEvent||{};r=d.FSharpEvent=d.FSharpEvent||{};s=d.FSharpDelegateEvent=d.FSharpDelegateEvent||{};t=l.EventModule=l.EventModule||{};u=d.MailboxProcessor=d.MailboxProcessor||{};v=window.IntelliFactory;w=v&&v.Runtime;x=c&&c.Util;y=c&&c.List;z=c&&c.Seq;A=c&&c.Unchecked;B=c&&c.Arrays;C=c&&c.Collections;D=C&&C.List;E=c&&c.Concurrency;F=c&&c.TimeoutException;G=c&&c.Operators;H=C&&C.LinkedList;f.Completed={$:2};e.New=function(I,J,K){return{OnNext:I,OnError:J,OnCompleted:function(){return K();}};};e.Of=function(I){return{OnNext:I,OnError:function(J){throw J;},OnCompleted:function(){return null;}};};h=g.HotStream=w.Class({Trigger:function(I){this.Latest[0]={$:1,$0:I};this.Event.event.Trigger(I);},Subscribe:function(I){this.Latest[0]!=null?I.OnNext(this.Latest[0].$0):void 0;return this.Event.event.Subscribe(x.observer(function(J){I.OnNext(J);}));}},null,h);h.New$1=function(){return h.New([null],new r.New());};h.New=function(I,J){return new h({Latest:I,Event:J});};i.Sequence=function(I){function J(K){return K.$==1?i.CombineLatest(K.$0,J(K.$1),function(L,M){return new y.T({$:1,$0:L,$1:M});}):i.Return(y.T.Empty);}return J(y.ofSeq(I));};i.Aggregate=function(I,J,K){return{Subscribe:function(L){var M;M=[J];return I.Subscribe(e.New(function(N){i.Protect(function(){return K(M[0],N);},function(O){M[0]=O;L.OnNext(O);},function(O){L.OnError(O);});},function(N){L.OnError(N);},function(){L.OnCompleted();}));}};};i.SelectMany=function(I){return{Subscribe:function(J){var K,L,M;K=[function(){}];L=I.Subscribe(x.observer(function(N){var O;O=N.Subscribe(x.observer(function(P){J.OnNext(P);}));K[0]=function(){K[0]();O.Dispose();};}));M=function(){K[0]();L.Dispose();};return{Dispose:function(){return M();}};}};};i.Switch=function(I){return{Subscribe:function(J){var K,L;K=[0];L=[null];return I.Subscribe(x.observer(function(M){var N;K[0]++;L[0]!=null?L[0].$0.Dispose():void 0;N=K[0];L[0]={$:1,$0:M.Subscribe(x.observer(function(O){if(N===K[0])J.OnNext(O);}))};}));}};};i.CombineLatest=function(I,J,K){return{Subscribe:function(L){var M,N,O,P,Q,R;M=[null];N=[null];O=function(){var S,T,U,V;S=M[0];T=N[0];S!=null&&S.$==1?T!=null&&T.$==1?(U=S.$0,V=T.$0,i.Protect(function(){return K(U,V);},function(W){L.OnNext(W);},function(W){L.OnError(W);})):void 0:void 0;};P=I.Subscribe(e.New(function(S){M[0]={$:1,$0:S};O();},function(S){},function(){}));Q=J.Subscribe(e.New(function(S){N[0]={$:1,$0:S};O();},function(S){},function(){}));R=function(){P.Dispose();Q.Dispose();};return{Dispose:function(){return R();}};}};};i.Range=function(I,J){return{Subscribe:function(K){var L,M,N;for(M=I,N=I+J;M<=N;M++)K.OnNext(M);L=function(){};return{Dispose:function(){return L();}};}};};i.Concat=function(I,J){return{Subscribe:function(K){var L,M,N;L=[null];M=I.Subscribe(e.New(function(O){K.OnNext(O);},function(O){},function(){L[0]={$:1,$0:J.Subscribe(K)};}));N=function(){L[0]!=null?L[0].$0.Dispose():void 0;M.Dispose();};return{Dispose:function(){return N();}};}};};i.Merge=function(I,J){return{Subscribe:function(K){var L,M,N,O,P;L=[false];M=[false];N=I.Subscribe(e.New(function(Q){K.OnNext(Q);},function(Q){},function(){L[0]=true;L[0]&&M[0]?K.OnCompleted():void 0;}));O=J.Subscribe(e.New(function(Q){K.OnNext(Q);},function(Q){},function(){M[0]=true;L[0]&&M[0]?K.OnCompleted():void 0;}));P=function(){N.Dispose();O.Dispose();};return{Dispose:function(){return P();}};}};};i.Drop=function(I,J){return{Subscribe:function(K){var L;L=[0];return J.Subscribe(e.New(function(M){L[0]++;L[0]>I?K.OnNext(M):void 0;},function(M){K.OnError(M);},function(){K.OnCompleted();}));}};};i.Choose=function(I,J){return{Subscribe:function(K){return J.Subscribe(e.New(function(L){var M;i.Protect(function(){return I(L);},(M=function(N){K.OnNext(N);},function(N){if(N==null);else M(N.$0);}),function(N){K.OnError(N);});},function(L){K.OnError(L);},function(){K.OnCompleted();}));}};};i.Filter=function(I,J){return{Subscribe:function(K){return J.Subscribe(e.New(function(L){var M;i.Protect(function(){return I(L)?{$:1,$0:L}:null;},(M=function(N){K.OnNext(N);},function(N){if(N==null);else M(N.$0);}),function(N){K.OnError(N);});},function(L){K.OnError(L);},function(){K.OnCompleted();}));}};};i.Map=function(I,J){return{Subscribe:function(K){return J.Subscribe(e.New(function(L){i.Protect(function(){return I(L);},function(M){K.OnNext(M);},function(M){K.OnError(M);});},function(L){K.OnError(L);},function(){K.OnCompleted();}));}};};i.Protect=function(I,J,K){var L;try{L={$:0,$0:I()};}catch(M){L={$:1,$0:M};}return L.$==1?K(L.$0):J(L.$0);};i.Never=function(){return{Subscribe:function(){var I;I=function(){};return{Dispose:function(){return I();}};}};};i.Return=function(I){return{Subscribe:function(J){var K;J.OnNext(I);J.OnCompleted();K=function(){};return{Dispose:function(){return K();}};}};};i.Of=function(I){return{Subscribe:function(J){var K;K=I(function(L){J.OnNext(L);});return{Dispose:function(){return K();}};}};};m.Split=function(I,J){return[i.Choose(function(K){var L;L=I(K);return L.$==0?{$:1,$0:L.$0}:null;},J),i.Choose(function(K){var L;L=I(K);return L.$==1?{$:1,$0:L.$0}:null;},J)];};m.Scan=function(I,J,K){return{Subscribe:function(L){var M;M=[J];return K.Subscribe(e.New(function(N){i.Protect(function(){return I(M[0],N);},function(O){M[0]=O;L.OnNext(O);},function(O){L.OnError(O);});},function(N){L.OnError(N);},function(){L.OnCompleted();}));}};};m.Partition=function(I,J){var K;return[i.Filter(I,J),i.Filter((K=function(L){return!L;},function(L){return K(I(L));}),J)];};m.Pairwise=function(I){return{Subscribe:function(J){var K;K=[null];return I.Subscribe(e.New(function(L){var M;M=K[0];M!=null&&M.$==1?J.OnNext([M.$0,L]):void 0;K[0]={$:1,$0:L};},function(L){J.OnError(L);},function(){J.OnCompleted();}));}};};o=n.Event=w.Class({Subscribe$1:function(I){var J,K,L;J=this;K=function(M,N){return I.OnNext(N);};this.AddHandler$1(K);L=function(){J.RemoveHandler$1(K);};return{Dispose:function(){return L();}};},RemoveHandler$1:function(I){var J;J=z.tryFindIndex(function(K){return A.Equals(I,K);},this.Handlers);J==null?void 0:this.Handlers.RemoveAt(J.$0);},AddHandler$1:function(I){this.Handlers.Add(I);},Trigger:function(I){var J,K,L;J=this.Handlers.ToArray();for(K=0,L=J.length-1;K<=L;K++)(B.get(J,K))(null,I);},RemoveHandler:function(I){this.RemoveHandler$1(I);},AddHandler:function(I){this.AddHandler$1(I);},Subscribe:function(I){return this.Subscribe$1(I);},Dispose:function(){}},null,o);o.New=function(I){return new o({Handlers:I});};q=p.DelegateEvent=w.Class({RemoveHandler$1:function(I){var J;J=z.tryFindIndex(function(K){return A.Equals(I,K);},this.Handlers);J==null?void 0:this.Handlers.RemoveAt(J.$0);},AddHandler$1:function(I){this.Handlers.Add(I);},Trigger:function(I){var J,K,L;J=this.Handlers.ToArray();for(K=0,L=J.length-1;K<=L;K++)B.get(J,K).apply(null,I);},RemoveHandler:function(I){this.RemoveHandler$1(I);},AddHandler:function(I){this.AddHandler$1(I);},Dispose:function(){}},null,q);q.New=function(I){return new q({Handlers:I});};r=d.FSharpEvent=w.Class({},null,r);r.New=w.Ctor(function(){this.event=o.New(new D.New$2());},r);s=d.FSharpDelegateEvent=w.Class({},null,s);s.New=w.Ctor(function(){this.event=q.New(new D.New$2());},s);t.Split=function(I,J){return[t.Choose(function(K){var L;L=I(K);return L.$==0?{$:1,$0:L.$0}:null;},J),t.Choose(function(K){var L;L=I(K);return L.$==1?{$:1,$0:L.$0}:null;},J)];};t.Scan=function(I,J,K){var L;L=[J];return t.Map(function(M){L[0]=I(L[0],M);return L[0];},K);};t.Partition=function(I,J){var K;return[t.Filter(I,J),t.Filter((K=function(L){return!L;},function(L){return K(I(L));}),J)];};t.Pairwise=function(I){var J,K;J=[null];K=o.New(new D.New$2());I.Subscribe(x.observer(function(L){var M;M=J[0];M!=null&&M.$==1?(J[0]={$:1,$0:L},K.Trigger([M.$0,L])):J[0]={$:1,$0:L};}));return K;};t.Merge=function(I,J){var K;K=o.New(new D.New$2());I.Subscribe(x.observer(function(L){K.Trigger(L);}));J.Subscribe(x.observer(function(L){K.Trigger(L);}));return K;};t.Map=function(I,J){var K;K=o.New(new D.New$2());J.Subscribe(x.observer(function(L){K.Trigger(I(L));}));return K;};t.Filter=function(I,J){var K;K=o.New(new D.New$2());J.Subscribe(x.observer(function(L){if(I(L))K.Trigger(L);}));return K;};t.Choose=function(I,J){var K;K=new r.New();J.Subscribe(x.observer(function(L){var M;M=I(L);M==null?void 0:K.event.Trigger(M.$0);}));return K.event;};u=d.MailboxProcessor=w.Class({dequeue:function(){var I;I=this.mailbox.n.v;this.mailbox.RemoveFirst();return I;},resume:function(){var I;I=this.savedCont;I!=null&&I.$==1?(this.savedCont=null,this.startAsync(I.$0)):void 0;},startAsync:function(I){E.Start(I,this.token);},Scan:function(I,J){var K,L;K=this;L=null;return E.Delay(function(){return E.Bind(K.TryScan(I,J),function(M){var N,O;if(M!=null&&M.$==1)O=M.$0;else throw new F.New();return E.Return(O);});});},TryScan:function(I,J){var K,L,M,N;K=this;L=(M=this.get_DefaultTimeout(),J==null?M:J.$0);N=null;return E.Delay(function(){var O,P,Q,R,S;P=K.mailbox.n;Q=null;while(!A.Equals(P,null)){S=I(P.v);S==null?P=P.n:(K.mailbox.Remove$1(P),P=null,Q=S);}O=Q;return O!=null&&O.$==1?E.Bind(O.$0,function(T){return E.Return({$:1,$0:T});}):(R=function(T){var V,W;if(L<0){function U(){var Y;K.savedCont={$:1,$0:(Y=null,E.Delay(function(){var Z;Z=I(K.mailbox.n.v);return Z!=null&&Z.$==1?(K.mailbox.RemoveFirst(),E.Bind(Z.$0,function(_0){T({$:1,$0:_0});return E.Return(null);})):(U(),E.Return(null));}))};}U();}else{function X(){var Y;K.savedCont={$:1,$0:(Y=null,E.Delay(function(){var Z;Z=I(K.mailbox.n.v);return Z!=null&&Z.$==1?(K.mailbox.RemoveFirst(),E.Bind(Z.$0,function(_0){return V[0]?(V[0]=false,a(W),T({$:1,$0:_0}),E.Return(null)):E.Return(null);})):(X(),E.Return(null));}))};}V=[true];W=b(function(){if(V[0]){V[0]=false;K.savedCont=null;T(null);}},L);X();}},E.FromContinuations(function(T,U,V){return R.apply(null,[T,U,V]);}));});},PostAndAsyncReply:function(I,J){var K,L;K=this;L=null;return E.Delay(function(){return E.Bind(K.PostAndTryAsyncReply(I,J),function(M){var N,O;if(M!=null&&M.$==1)O=M.$0;else throw new F.New();return E.Return(O);});});},PostAndTryAsyncReply:function(I,J){var K,L,M,N;K=this;L=(M=this.get_DefaultTimeout(),J==null?M:J.$0);N=function(O){var P,Q;if(L<0){K.mailbox.AddLast(I((P=function(R){return{$:1,$0:R};},function(R){return O(P(R));})));K.resume();}else{Q=[true];K.mailbox.AddLast(I(function(R){if(Q[0]){Q[0]=false;O({$:1,$0:R});}}));K.resume();b(function(){if(Q[0]){Q[0]=false;O(null);}},L);}};return E.FromContinuations(function(O,P,Q){return N.apply(null,[O,P,Q]);});},get_CurrentQueueLength:function(){return this.mailbox.c;},Receive:function(I){var J,K;J=this;K=null;return E.Delay(function(){return E.Bind(J.TryReceive(I),function(L){var M,N;if(L!=null&&L.$==1)N=L.$0;else throw new F.New();return E.Return(N);});});},TryReceive:function(I){var J,K,L,M;J=this;K=(L=this.get_DefaultTimeout(),I==null?L:I.$0);M=function(N){var O,P,Q,R;if(A.Equals(J.mailbox.n,null)){if(K<0){J.savedCont={$:1,$0:(O=null,E.Delay(function(){N({$:1,$0:J.dequeue()});return E.Return(null);}))};}else{P=[true];Q=b(function(){if(P[0]){P[0]=false;J.savedCont=null;N(null);}},K);J.savedCont={$:1,$0:(R=null,E.Delay(function(){return P[0]?(P[0]=false,a(Q),N({$:1,$0:J.dequeue()}),E.Return(null)):E.Return(null);}))};}}else N({$:1,$0:J.dequeue()});};return E.FromContinuations(function(N,O,P){return M.apply(null,[N,O,P]);});},Start:function(){var I,J;I=this;this.started?G.FailWith("The MailboxProcessor has already been started."):(this.started=true,I.startAsync((J=null,E.Delay(function(){return E.TryWith(E.Delay(function(){return E.Bind(I.initial(I),function(){return E.Return(null);});}),function(K){I.errorEvent.event.Trigger(K);return E.Return(null);});}))));},set_DefaultTimeout:function(I){this.DefaultTimeout=I;},get_DefaultTimeout:function(){return this.DefaultTimeout;},remove_Error:function(I){this.errorEvent.event.RemoveHandler(I);},add_Error:function(I){this.errorEvent.event.AddHandler(I);},get_Error:function(){return this.errorEvent.event;}},null,u);u.Start=function(I,J){var K;K=new u.New(I,J);K.Start();return K;};u.New=w.Ctor(function(I,J){var K,L,M;K=this;this.initial=I;this.token=J;this.started=false;this.errorEvent=new r.New();this.mailbox=new H.New();this.savedCont=null;L=this.token;L==null?void 0:(M=function(){return K.resume();},E.Register(L.$0,function(){M();}));this.DefaultTimeout=-1;},u);}());
