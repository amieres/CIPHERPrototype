(function(){"use strict";var t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2;var a=Array,b=String,c=console,d=jQuery,e=document,f=H5F,g=id,h=JSON,i=IntelliFactory,j=requestAnimationFrame,k=isNaN,l=Object,m=Node,n=Element,o=RegExp,p=Symbol,q=Text,r=decodeURIComponent,s=encodeURIComponent;t=window.WebSharper=window.WebSharper||{};u=t.UI=t.UI||{};v=u.Next=u.Next||{};w=v.Array=v.Array||{};x=v.String=v.String||{};y=v.Abbrev=v.Abbrev||{};z=y.Fresh=y.Fresh||{};A=y.HashSet=y.HashSet||{};B=y.Dict=y.Dict||{};C=y.Slot=y.Slot||{};D=y.Async=y.Async||{};E=y.Mailbox=y.Mailbox||{};F=E.MailboxState=E.MailboxState||{};G=window.StartupCode$WebSharper_UI_Next$Abbrev=window.StartupCode$WebSharper_UI_Next$Abbrev||{};H=v.AppendList=v.AppendList||{};I=window.StartupCode$WebSharper_UI_Next$AppendList=window.StartupCode$WebSharper_UI_Next$AppendList||{};J=v.DomUtility=v.DomUtility||{};K=window.StartupCode$WebSharper_UI_Next$DomUtility=window.StartupCode$WebSharper_UI_Next$DomUtility||{};L=v.Trie=v.Trie||{};M=L.LookupResult=L.LookupResult||{};N=window.StartupCode$WebSharper_UI_Next$Trie=window.StartupCode$WebSharper_UI_Next$Trie||{};O=v.Snap=v.Snap||{};P=v.Var=v.Var||{};Q=v.View=v.View||{};R=v.ViewBuilder=v.ViewBuilder||{};S=v.Submitter=v.Submitter||{};T=v.Key=v.Key||{};U=v.Model=v.Model||{};V=v.Serializer=v.Serializer||{};W=v.Storage=v.Storage||{};X=W.ArrayStorage=W.ArrayStorage||{};Y=W.LocalStorageBackend=W.LocalStorageBackend||{};Z=v.ListModel=v.ListModel||{};_0=v.ListModels=v.ListModels||{};_1=window.StartupCode$WebSharper_UI_Next$Models=window.StartupCode$WebSharper_UI_Next$Models||{};_2=v.ReactiveExtensions=v.ReactiveExtensions||{};_3=v.DoubleInterpolation=v.DoubleInterpolation||{};_4=v.Interpolation=v.Interpolation||{};_5=v.Easing=v.Easing||{};_6=v.Easings=v.Easings||{};_7=v.An=v.An||{};_8=v.Anims=v.Anims||{};_9=v.Trans=v.Trans||{};_=window.StartupCode$WebSharper_UI_Next$Animation=window.StartupCode$WebSharper_UI_Next$Animation||{};$=v.AnimatedAttrNode=v.AnimatedAttrNode||{};ba=v.DynamicAttrNode=v.DynamicAttrNode||{};bb=v.AttrProxy=v.AttrProxy||{};bc=v.Client=v.Client||{};bd=bc.Attrs=bc.Attrs||{};be=bd.Dyn=bd.Dyn||{};bf=v.Attrs=v.Attrs||{};bg=v.CheckedInput=v.CheckedInput||{};bh=v.AttrModule=v.AttrModule||{};bi=window.StartupCode$WebSharper_UI_Next$Attr_Client=window.StartupCode$WebSharper_UI_Next$Attr_Client||{};bj=bc.DocNode=bc.DocNode||{};bk=v.DocElemNode=v.DocElemNode||{};bl=bc.Docs=bc.Docs||{};bm=bl.DomNodes=bl.DomNodes||{};bn=bl.NodeSet=bl.NodeSet||{};bo=bl.RunState=bl.RunState||{};bp=v.Docs=v.Docs||{};bq=v.Doc=v.Doc||{};br=v.Elt=v.Elt||{};bs=bc.EltUpdater=bc.EltUpdater||{};bt=window.StartupCode$WebSharper_UI_Next$Doc_Client=window.StartupCode$WebSharper_UI_Next$Doc_Client||{};bu=v.Flow=v.Flow||{};bv=v.FlowBuilder=v.FlowBuilder||{};bw=v.Html=v.Html||{};bx=bw.attr=bw.attr||{};by=v.Route=v.Route||{};bz=v.Routing=v.Routing||{};bA=bz.State=bz.State||{};bB=v.RouteMap=v.RouteMap||{};bC=v.Router=v.Router||{};bD=v.Input=v.Input||{};bE=bD.MousePosSt=bD.MousePosSt||{};bF=bD.MouseBtnSt=bD.MouseBtnSt||{};bG=bD.Mouse=bD.Mouse||{};bH=bD.KeyListenerSt=bD.KeyListenerSt||{};bI=bD.Keyboard=bD.Keyboard||{};bJ=window.StartupCode$WebSharper_UI_Next$Input=window.StartupCode$WebSharper_UI_Next$Input||{};bK=t&&t.List;bL=t&&t.Arrays;bM=t&&t.Enumerator;bN=t&&t.Strings;bO=t&&t.Char;bP=t&&t.Collections;bQ=bP&&bP.HashSet;bR=t&&t.Seq;bS=i&&i.Runtime;bT=t&&t.Unchecked;bU=t&&t.Concurrency;bV=bP&&bP.Map;bW=bP&&bP.FSharpMap;bX=bP&&bP.List;bY=t&&t.Operators;bZ=t&&t.Lazy;b0=bP&&bP.Dictionary;b1=t&&t.Numeric;b2=t&&t.Slice;w.mapInPlace=function(b3,b4){var b5,b6;for(b5=0,b6=b4.length-1;b5<=b6;b5++)b4[b5]=b3(b4[b5]);return b4;};w.ofSeqNonCopying=function(b3){var b4,b5;if(b3 instanceof a)return b3;else if(b3 instanceof bK.T)return bL.ofList(b3);else if(b3===null)return[];else{b4=[];b5=bM.Get(b3);try{while(b5.MoveNext())b4.push(b5.Current());return b4;}finally{if("Dispose"in b5)b5.Dispose();}}};w.MapTreeReduce=function(b3,b4,b5,b6){var b7;function b8(b9,b_){var b$,ca;return b_<=0?b4:b_===1&&(b9>=0&&b9<b7&&true)?b3(bL.get(b6,b9)):(ca=b_/2>>0,b5(b8(b9,ca),b8(b9+ca,b_-ca)));}b7=bL.length(b6);return b8(0,b7);};w.TreeReduce=function(b3,b4,b5){var b6;function b7(b8,b9){var b_,b$;return b9<=0?b3:b9===1&&(b8>=0&&b8<b6&&true)?bL.get(b5,b8):(b$=b9/2>>0,b4(b7(b8,b$),b7(b8+b$,b9-b$)));}b6=bL.length(b5);return b7(0,b6);};x.isBlank=function(b3){return bN.forall(bO.IsWhiteSpace,b3);};z.Id=function(){z.set_counter(z.counter()+1);return"uid"+b(z.counter());};z.Int=function(){z.set_counter(z.counter()+1);return z.counter();};z.counter=function(){G.$cctor();return G.counter;};z.set_counter=function(b3){G.$cctor();G.counter=b3;};A.Filter=function(b3,b4){return new bQ.New$2(bL.filter(b3,A.ToArray(b4)));};A.Intersect=function(b3,b4){var b5;b5=new bQ.New$2(A.ToArray(b3));b5.IntersectWith(A.ToArray(b4));return b5;};A.Except=function(b3,b4){var b5;b5=new bQ.New$2(A.ToArray(b4));b5.ExceptWith(A.ToArray(b3));return b5;};A.ToArray=function(b3){var b4;b4=bL.create(b3.get_Count(),void 0);b3.CopyTo(b4);return b4;};B.ToValueArray=function(b3){var b4;b4=bL.create(b3.count,void 0);bR.iteri(function(b5,b6){return bL.set(b4,b5,b6.V);},b3);return b4;};B.ToKeyArray=function(b3){var b4;b4=bL.create(b3.count,void 0);bR.iteri(function(b5,b6){return bL.set(b4,b5,b6.K);},b3);return b4;};C=y.Slot=bS.Class({GetHashCode:function(){return bT.Hash(this.key(this.value));},Equals:function(b3){return bT.Equals(this.key(this.value),this.key(b3.get_Value()));},get_Value:function(){return this.value;}},null,C);C.New=bS.Ctor(function(b3,b4){this.key=b3;this.value=b4;},C);C.Create=function(b3,b4){return new C.New(b3,b4);};D.OnError=function(b3){return c.log("WebSharper UI.Next: Uncaught asynchronous exception",b3);};D.Schedule=function(b3){var b4;bU.Start((b4=null,bU.Delay(function(){b3();return bU.Return(null);})),null);};D.StartTo=function(b3,b4){bU.StartWithContinuations(b3,b4,function(b5){D.OnError(b5);},function(b5){},null);};F=E.MailboxState=bS.Class({},null,F);E.StartProcessor=function(b3){var b4;function b5(){var b6;b6=null;return bU.Delay(function(){return bU.Bind(b3,function(){var b7;b7=b4[0];return bT.Equals(b7,1)?(b4[0]=0,bU.Return(null)):bT.Equals(b7,2)?(b4[0]=1,bU.Bind(b5(),function(){return bU.Return(null);})):bU.Return(null);});});}b4=[0];return function(){var b6;b6=b4[0];bT.Equals(b6,0)?(b4[0]=1,bU.Start(b5(),null)):bT.Equals(b6,1)?b4[0]=2:void 0;};};G.$cctor=bS.Cctor(function(){G.counter=0;G.$cctor=window.ignore;});H.FromArray=function(b3){var b4;b4=b3.length;return b4===0?{$:0}:b4===1?{$:1,$0:bL.get(b3,0)}:{$:3,$0:b3.slice()};};H.ToArray=function(b3){var b4;function b5(b6){if(b6.$==1)b4.push(b6.$0);else if(b6.$==2){b5(b6.$0);b5(b6.$1);}else if(b6.$==3)bL.iter(function(b7){b4.push(b7);},b6.$0);}b4=[];b5(b3);return b4.slice(0);};H.Single=function(b3){return{$:1,$0:b3};};H.Concat=function(b3){var b4;b4=w.ofSeqNonCopying(b3);return w.TreeReduce(H.Empty(),H.Append,b4);};H.Append=function(b3,b4){return b3.$==0?b4:b4.$==0?b3:{$:2,$0:b3,$1:b4};};H.Empty=function(){I.$cctor();return I.Empty;};I.$cctor=bS.Cctor(function(){I.Empty={$:0};I.$cctor=window.ignore;});J.SetProperty=function(b3,b4,b5){return b3.setProperty(b4,b5);};J.IterSelector=function(b3,b4,b5){var b6,b7,b8;b6=b3.querySelectorAll(b4);for(b7=0,b8=b6.length-1;b7<=b8;b7++)b5(b6[b7]);};J.ChildrenArray=function(b3){var b4,b5,b6;b4=[];for(b5=0,b6=b3.childNodes.length-1;b5<=b6;b5++)b4.push(b3.childNodes[b5]);return b4;};J.RemoveClass=function(b3,b4){d(b3).removeClass(b4);};J.AddClass=function(b3,b4){d(b3).addClass(b4);};J.InsertAt=function(b3,b4,b5){var b6;if(!(b5.parentNode===b3&&b4===(b6=b5.nextSibling,bT.Equals(b6,null)?null:b6)))b3.insertBefore(b5,b4);};J.RemoveNode=function(b3,b4){if(b4.parentNode===b3)b3.removeChild(b4);};J.SetStyle=function(b3,b4,b5){J.SetProperty(b3.style,b4,b5);};J.SetAttr=function(b3,b4,b5){b3.setAttribute(b4,b5);};J.RemoveAttr=function(b3,b4){b3.removeAttribute(b4);};J.CreateAttr=function(b3,b4){var b5;b5=J.Doc().createAttribute(b3);b5.value=b4;return b5;};J.CreateText=function(b3){return J.Doc().createTextNode(b3);};J.CreateSvgElement=function(b3){return J.Doc().createElementNS("http://www.w3.org/2000/svg",b3);};J.CreateElement=function(b3){return J.Doc().createElement(b3);};J.Clear=function(b3){while(b3.hasChildNodes())b3.removeChild(b3.firstChild);};J.ClearAttrs=function(b3){while(b3.hasAttributes())b3.removeAttributeNode(b3.attributes.item(0));};J.AppendTo=function(b3,b4){b3.appendChild(b4);};J.Doc=function(){K.$cctor();return K.Doc;};K.$cctor=bS.Cctor(function(){K.Doc=e;K.$cctor=window.ignore;});M.NotFound={$:1};L.Empty=function(){N.$cctor();return N.Empty;};L.Lookup=function(b3,b4){return L.Look(bK.ofSeq(b4),b3);};L.Look=function(b3,b4){var b5,b6;switch(b4.$==2?(b5=b4.$0,0):b4.$==0?b3.$==1?(b5=[b3.$0,b3.$1,b4.$0],1):2:2){case 0:return{$:0,$0:b5,$1:b3};break;case 1:b6=bV.TryFind(b5[0],b5[2]);return b6==null?M.NotFound:L.Look(b5[1],b6.$0);break;case 2:return M.NotFound;break;}};L.ToArray=function(b3){var b4;b4=[];L.Map(function(){return function(b5){return b4.push(b5);};},b3);return b4.slice(0);};L.Mapi=function(b3,b4){var b5,b6;b5=[0];b6=function(){var b7;b7=b5[0];b5[0]=b7+1;return b7;};return L.Map(function(b7){return b3(b6(),b7);},b4);};L.Map=function(b3,b4){return L.MapLoop(bK.T.Empty,b3,b4);};L.MapLoop=function(b3,b4,b5){return b5.$==1?{$:1}:b5.$==2?{$:2,$0:(b4(b3))(b5.$0)}:L.TrieBranch(bV.Map(function(b6,b7){return L.MapLoop(bK.append(b3,bK.ofArray([b6])),b4,b7);},b5.$0));};L.Merge=function(b3){var b4,b5,b6;b4=w.ofSeqNonCopying(b3);b5=bL.length(b4);return b5===0?{$:1,$0:{$:1}}:b5===1?{$:1,$0:bL.get(b4,0)}:bL.exists(L.IsLeaf,b4)?null:(b6=L.MergeMaps(L.Merge,bR.choose(function(b7){return b7.$==0?{$:1,$0:b7.$0}:null;},b4)),b6==null?null:{$:1,$0:L.TrieBranch(b6.$0)});};L.IsLeaf=function(b3){return b3.$==2&&true;};L.MergeMaps=function(b3,b4){var b5,b6;b5=L.AllSome((b6=function(b7,b8){var b9;b9=b3(b8);return b9==null?null:{$:1,$0:[b7,b9.$0]};},bR.map(function(b7){return b6(b7[0],b7[1]);},bV.ToSeq(bR.fold(function(b7,b8){return L.MultiAdd(b8[0],b8[1],b7);},new bW.New([]),bR.collect(bV.ToSeq,b4))))));return b5==null?null:{$:1,$0:bV.OfArray(bL.ofSeq(b5.$0))};};L.AllSome=function(b3){var b4,b5,b6,b7;b5=bM.Get(b3);b6=new bX.New$2();b4=true;while(b4&&b5.MoveNext()){b7=b5.Current();b7!=null&&b7.$==1?b6.Add(b7.$0):b4=false;}return b4?{$:1,$0:b6.ToArray()}:null;};L.MultiAdd=function(b3,b4,b5){return b5.Add(b3,new bK.T({$:1,$0:b4,$1:L.MultiFind(b3,b5)}));};L.MultiFind=function(b3,b4){var b5;b5=bV.TryFind(b3,b4);return b5==null?bK.T.Empty:b5.$0;};L.Prefix=function(b3,b4){return L.TrieBranch(new bW.New(bK.ofArray([[b3,b4]])));};L.Leaf=function(b3){return{$:2,$0:b3};};L.TrieBranch=function(b3){return b3.get_IsEmpty()?{$:1}:{$:0,$0:b3};};N.$cctor=bS.Cctor(function(){N.Empty={$:1};N.$cctor=window.ignore;});O.MapAsync=function(b3,b4){var b5;b5=O.Create();O.When(b4,function(b6){D.StartTo(b3(b6),function(b7){O.MarkDone(b5,b4,b7);});},O.Obs(b5));return b5;};O.SnapshotOn=function(b3,b4){var b5;function b6(b7){var b8,b9;if(!O.IsDone(b5)){b8=O.ValueAndForever(b3);b9=O.ValueAndForever(b4);b8!=null&&b8.$==1?b9!=null&&b9.$==1?b8.$0[1]||b9.$0[1]?O.MarkForever(b5,b9.$0[0]):O.MarkReady(b5,b9.$0[0]):void 0:void 0;}}b5=O.Create();O.When(b3,b6,O.Obs(b5));O.When(b4,b6,function(){});return b5;};O.Map3=function(b3,b4,b5,b6){var b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci;function cj(ck){var cl,cm,cn;if(!O.IsDone(ch)){cl=O.ValueAndForever(b4);cm=O.ValueAndForever(b5);cn=O.ValueAndForever(b6);cl!=null&&cl.$==1?cm!=null&&cm.$==1?cn!=null&&cn.$==1?cl.$0[1]&&cm.$0[1]&&cn.$0[1]?O.MarkForever(ch,b3(cl.$0[0],cm.$0[0],cn.$0[0])):O.MarkReady(ch,b3(cl.$0[0],cm.$0[0],cn.$0[0])):void 0:void 0:void 0;}}b7=b4.s;b8=b5.s;b9=b6.s;return b7.$==0?b8.$==0?b9.$==0?O.CreateForever(b3(b7.$0,b8.$0,b9.$0)):(b_=b7.$0,(b$=b8.$0,O.Map(function(ck){return b3(b_,b$,ck);},b6))):b9.$==0?(ca=b7.$0,(cb=b9.$0,O.Map(function(ck){return b3(ca,ck,cb);},b5))):(cc=b7.$0,O.Map2(function(ck,cl){return b3(cc,ck,cl);},b5,b6)):b8.$==0?b9.$==0?(cd=b8.$0,(ce=b9.$0,O.Map(function(ck){return b3(ck,cd,ce);},b4))):(cf=b8.$0,O.Map2(function(ck,cl){return b3(ck,cf,cl);},b4,b6)):b9.$==0?(cg=b9.$0,O.Map2(function(ck,cl){return b3(ck,cl,cg);},b4,b5)):(ch=O.Create(),(ci=O.Obs(ch),(O.When(b4,cj,ci),O.When(b5,cj,ci),O.When(b6,cj,ci),ch)));};O.Map2Unit=function(b3,b4){var b5,b6;function b7(){var b8,b9;if(!O.IsDone(b5)){b8=O.ValueAndForever(b3);b9=O.ValueAndForever(b4);b8!=null&&b8.$==1?b9!=null&&b9.$==1?b8.$0[1]&&b9.$0[1]?O.MarkForever(b5,null):O.MarkReady(b5,null):void 0:void 0;}}return b3.s.$==0?b4.s.$==0?O.CreateForever():b4:b4.s.$==0?b3:(b5=O.Create(),(b6=O.Obs(b5),(O.When(b3,b7,b6),O.When(b4,b7,b6),b5)));};O.Map2=function(b3,b4,b5){var b6,b7,b8,b9,b_,b$;function ca(cb){var cc,cd;if(!O.IsDone(b_)){cc=O.ValueAndForever(b4);cd=O.ValueAndForever(b5);cc!=null&&cc.$==1?cd!=null&&cd.$==1?cc.$0[1]&&cd.$0[1]?O.MarkForever(b_,b3(cc.$0[0],cd.$0[0])):O.MarkReady(b_,b3(cc.$0[0],cd.$0[0])):void 0:void 0;}}b6=b4.s;b7=b5.s;return b6.$==0?b7.$==0?O.CreateForever(b3(b6.$0,b7.$0)):(b8=b6.$0,O.Map(function(cb){return b3(b8,cb);},b5)):b7.$==0?(b9=b7.$0,O.Map(function(cb){return b3(cb,b9);},b4)):(b_=O.Create(),(b$=O.Obs(b_),(O.When(b4,ca,b$),O.When(b5,ca,b$),b_)));};O.MapCachedBy=function(b3,b4,b5,b6){return O.Map(function(b7){var b8,b9,b_;b8=b4[0];return b8!=null&&b8.$==1&&(b3(b7,b8.$0[0])&&(b9=[b8.$0[0],b8.$0[1]],true))?b9[1]:(b_=b5(b7),(b4[0]={$:1,$0:[b7,b_]},b_));},b6);};O.Map=function(b3,b4){var b5,b6,b7;b5=b4.s;return b5.$==0?O.CreateForever(b3(b5.$0)):(b6=O.Create(),(O.When(b4,(b7=function(b8){O.MarkDone(b6,b4,b8);},function(b8){return b7(b3(b8));}),O.Obs(b6)),b6));};O.Sequence=function(b3){var b4,b5,b6,b7,b8;b4=bL.ofSeq(b3);return b4.length==0?O.CreateForever([]):(b5=O.Create(),(b6=[bL.length(b4)-1],(b7=O.Obs(b5),(b8=function(){var b9;if(b6[0]===0){b9=bL.map(function(b_){var b$;b$=b_.s;return b$.$==0?b$.$0:b$.$==2?b$.$0:bY.FailWith("value not found by View.Sequence");},b4);bL.forall(O.IsForever,b4)?O.MarkForever(b5,b9):O.MarkReady(b5,b9);}else b6[0]--;},(bL.iter(function(b9){O.When(b9,b8,b7);},b4),b5)))));};O.CreateForeverAsync=function(b3){var b4;b4=O.Make({$:3,$0:[],$1:[]});D.StartTo(b3,function(b5){O.MarkForever(b4,b5);});return b4;};O.JoinInner=function(b3){var b4,b5;b4=O.Create();b5=O.Obs(b4);O.When(b3,function(b6){var b7;b7=b6();O.When(b7,function(b8){if(O.IsForever(b7)&&O.IsForever(b3))O.MarkForever(b4,b8);else O.MarkReady(b4,b8);},b5);O.WhenObsolete(b3,O.Obs(b7));},b5);return b4;};O.Join=function(b3){var b4,b5;b4=O.Create();b5=O.Obs(b4);O.When(b3,function(b6){var b7;b7=b6();O.When(b7,function(b8){if(O.IsForever(b7)&&O.IsForever(b3))O.MarkForever(b4,b8);else O.MarkReady(b4,b8);},b5);},b5);return b4;};O.ValueAndForever=function(b3){var b4;b4=b3.s;return b4.$==0?{$:1,$0:[b4.$0,true]}:b4.$==2?{$:1,$0:[b4.$0,false]}:null;};O.WhenObsolete=function(b3,b4){var b5;b5=b3.s;b5.$==1?b4():b5.$==2?b5.$1.push(b4):b5.$==3?b5.$1.push(b4):void 0;};O.When=function(b3,b4,b5){var b6;b6=b3.s;b6.$==1?b5():b6.$==2?(b6.$1.push(b5),b4(b6.$0)):b6.$==3?(b6.$0.push(b4),b6.$1.push(b5)):b4(b6.$0);};O.MarkDone=function(b3,b4,b5){if(O.IsForever(b4))O.MarkForever(b3,b5);else O.MarkReady(b3,b5);};O.MarkReady=function(b3,b4){var b5;b5=b3.s;b5.$==3?(b3.s={$:2,$0:b4,$1:b5.$1},bR.iter(function(b6){b6(b4);},b5.$0)):void 0;};O.Obs=function(b3){return function(){O.MarkObsolete(b3);};};O.MarkObsolete=function(b3){var b4,b5;b4=b3.s;b4.$==1||(b4.$==2?(b5=b4.$1,false):b4.$==3?(b5=b4.$1,false):true)?void 0:(b3.s={$:1},bR.iter(function(b6){b6();},b5));};O.MarkForever=function(b3,b4){var b5;b5=b3.s;b5.$==3?(b3.s={$:0,$0:b4},bR.iter(function(b6){b6(b4);},b5.$0)):void 0;};O.IsDone=function(b3){var b4;b4=b3.s;return b4.$==0||b4.$==2&&true;};O.IsObsolete=function(b3){return b3.s.$==1&&true;};O.IsForever=function(b3){return b3.s.$==0&&true;};O.CreateWithValue=function(b3){return O.Make({$:2,$0:b3,$1:[]});};O.CreateForever=function(b3){return O.Make({$:0,$0:b3});};O.Create=function(){return O.Make({$:3,$0:[],$1:[]});};O.Make=function(b3){return{s:b3};};P=v.Var=bS.Class({RId:function(){return"uinref"+b(this.i);},RView:function(){return this.v;},RUpdM:function(b3){var b4;b4=b3(this.c);b4!=null&&b4.$==1?P.Set(this,b4.$0):void 0;},RUpd:function(b3){P.Update(this,b3);},set_RVal:function(b3){P.Set(this,b3);},RVal:function(){return this.c;},RSet:function(b3){P.Set(this,b3);},RGet:function(){return this.c;}},null,P);P.New=function(b3,b4,b5,b6,b7){return new P({o:b3,c:b4,s:b5,i:b6,v:b7});};P.Lens=function(b3,b4,b5){var b6,b7;b6=z.Id();b7=Q.Map(b4,b3.RView());return{RGet:function(){return b4(b3.RGet());},RSet:function(b8){return b3.RUpd(function(b9){return b5(b9,b8);});},RVal:function(){return b4(b3.RGet());},set_RVal:function(b8){return b3.RUpd(function(b9){return b5(b9,b8);});},RUpd:function(b8){return b3.RUpd(function(b9){return b5(b9,b8(b4(b9)));});},RUpdM:function(b8){return b3.RUpdM(function(b9){var b_;b_=b8(b4(b9));return b_==null?null:{$:1,$0:b5(b9,b_.$0)};});},RView:function(){return b7;},RId:function(){return b6;}};};P.Update=function(b3,b4){P.Set(b3,b4(b3.c));};P.SetFinal=function(b3,b4){if(b3.o)(function(b5){return b5("WebSharper UI.Next: invalid attempt to change value of a Var after calling SetFinal");}(function(b5){c.log(b5);}));else{O.MarkObsolete(b3.s);b3.o=true;b3.c=b4;b3.s=O.CreateForever(b4);}};P.Set=function(b3,b4){if(b3.o)(function(b5){return b5("WebSharper UI.Next: invalid attempt to change value of a Var after calling SetFinal");}(function(b5){c.log(b5);}));else{O.MarkObsolete(b3.s);b3.c=b4;b3.s=O.CreateWithValue(b4);}};P.Create=function(){var b3;b3=null;b3=P.New(false,null,O.CreateWithValue(),z.Int(),function(){return b3.s;});return b3;};P.Create$1=function(b3){var b4;b4=null;b4=P.New(false,b3,O.CreateWithValue(b3),z.Int(),function(){return b4.s;});return b4;};Q.get_Do=function(){return R.B;};Q.Apply=function(b3,b4){return Q.Map2(function(b5,b6){return b5(b6);},b3,b4);};Q.AsyncAwait=function(b3,b4){var b5;b5=function(b6){var b7,b8;function b9(){return Q.RemovableSink(function(b_){if(b3(b_)){(bZ.Force(b7))();b6(b_);}},b4);}b7=bZ.Create(b9);b8=bZ.Force(b7);};return bU.FromContinuations(function(b6,b7,b8){return b5.apply(null,[b6,b7,b8]);});};Q.RemovableSink=function(b3,b4){var b5;function b6(){O.When(b4(),function(b7){if(b5[0])b3(b7);},function(){if(b5[0])D.Schedule(b6);});}b5=[true];D.Schedule(b6);return function(){b5[0]=false;};};Q.Sink=function(b3,b4){function b5(){O.When(b4(),b3,function(){D.Schedule(b5);});}D.Schedule(b5);};Q.TryFinally=function(b3,b4){return Q.CreateLazy(function(){try{return b4();}finally{b3();}});};Q.TryWith=function(b3,b4){return Q.CreateLazy(function(){try{return b4();}catch(b5){return(b3(b5))();}});};Q.ConstAsync=function(b3){var b4;b4=O.CreateForeverAsync(b3);return function(){return b4;};};Q.Const=function(b3){var b4;b4=O.CreateForever(b3);return function(){return b4;};};Q.Sequence=function(b3){return Q.CreateLazy(function(){return O.Sequence(bR.map(function(b4){return b4();},b3));});};Q.UpdateWhile=function(b3,b4,b5){var b6;b6=[b3];return Q.BindInner(function(b7){return b7?Q.Map(function(b8){b6[0]=b8;return b8;},b5):Q.Const(b6[0]);},b4);};Q.BindInner=function(b3,b4){return Q.JoinInner(Q.Map(b3,b4));};Q.JoinInner=function(b3){return Q.CreateLazy(function(){return O.JoinInner(b3());});};Q.Bind=function(b3,b4){return Q.Join(Q.Map(b3,b4));};Q.Join=function(b3){return Q.CreateLazy(function(){return O.Join(b3());});};Q.MapSeqCachedView=function(b3,b4){var b5;b5=function(){return b3;};return Q.MapSeqCachedViewBy(g,function(b6,b7){return(b5(b6))(b7);},b4);};Q.MapSeqCachedViewBy=function(b3,b4,b5){var b6;b6=[new b0.New$5()];return Q.Map(function(b7){var b8,b9,b_;b8=b6[0];b9=new b0.New$5();b_=w.mapInPlace(function(b$){var ca,cb,cc;ca=b3(b$);cb=b8.ContainsKey(ca)?(cc=b8.get_Item(ca),(P.Set(cc.r,b$),cc)):Q.ConvertSeqNode(function(cd){return b4(ca,cd);},b$);b9.set_Item(ca,cb);return cb.e;},bL.ofSeq(b7));b6[0]=b9;return b_;},b5);};Q.ConvertSeqNode=function(b3,b4){var b5,b6;b5=P.Create$1(b4);b6=b5.v;return{e:b3(b6),r:b5,w:b6};};Q.MapSeqCached=function(b3,b4){return Q.MapSeqCachedBy(g,b3,b4);};Q.MapSeqCachedBy=function(b3,b4,b5){var b6;b6=[new b0.New$5()];return Q.Map(function(b7){var b8,b9,b_;b8=b6[0];b9=new b0.New$5();b_=w.mapInPlace(function(b$){var ca,cb;ca=b3(b$);cb=b8.ContainsKey(ca)?b8.get_Item(ca):b4(b$);b9.set_Item(ca,cb);return cb;},bL.ofSeq(b7));b6[0]=b9;return b_;},b5);};Q.SnapshotOn=function(b3,b4,b5){var b6;b6=O.CreateWithValue(b3);return Q.CreateLazy(function(){return O.IsObsolete(b6)?O.SnapshotOn(b4(),b5()):(O.WhenObsolete(b4(),O.Obs(b6)),b6);});};Q.GetAsync=function(b3){return bU.FromContinuations(function(b4){return Q.Get(b4,b3);});};Q.Get=function(b3,b4){var b5;function b6(){O.When(b4(),function(b7){if(!b5[0]){b5[0]=true;b3(b7);}},function(){if(!b5[0])b6();});}b5=[false];b6();};Q.MapAsync2=function(b3,b4,b5){return Q.MapAsync(g,Q.Map2(b3,b4,b5));};Q.MapAsync=function(b3,b4){return Q.CreateLazy(function(){return O.MapAsync(b3,b4());});};Q.Map3=function(b3,b4,b5,b6){return Q.CreateLazy(function(){return O.Map3(b3,b4(),b5(),b6());});};Q.Map2Unit=function(b3,b4){return Q.CreateLazy(function(){return O.Map2Unit(b3(),b4());});};Q.Map2=function(b3,b4,b5){return Q.CreateLazy(function(){return O.Map2(b3,b4(),b5());});};Q.MapCached=function(b3,b4){return Q.MapCachedBy(bT.Equals,b3,b4);};Q.MapCachedBy=function(b3,b4,b5){var b6;b6=[null];return Q.CreateLazy(function(){return O.MapCachedBy(b3,b6,b4,b5());});};Q.Map=function(b3,b4){return Q.CreateLazy(function(){return O.Map(b3,b4());});};Q.CreateLazy=function(b3){var b4;b4={c:null,o:b3};return function(){var b5;b5=b4.c;return b5===null?(b5=b4.o(),b4.c=b5,O.IsForever(b5)?b4.o=null:O.WhenObsolete(b5,function(){b4.c=null;}),b5):b5;};};R.B={$:0};S=v.Submitter=bS.Class({Trigger:function(){P.Set(this["var"],null);}},null,S);S.New=bS.Ctor(function(b3,b4){this.input=b3;this["var"]=P.Create();this.view=Q.SnapshotOn(b4,this["var"].v,this.input);},S);S.CreateOption=function(b3){return new S.New(Q.Map(function(b4){return{$:1,$0:b4};},b3),null);};T.Fresh=function(){return{$:0,$0:z.Int()};};U=v.Model=bS.Class({},null,U);U.New=bS.Ctor(function(b3,b4){var b5;b5=P.Create$1(b4);U.New$1.call(this,b5,Q.Map(b3,b5.v));},U);U.New$1=bS.Ctor(function(b3,b4){this["var"]=b3;this.view=b4;},U);U.Update=function(b3,b4){P.Update(b4["var"],function(b5){b3(b5);return b5;});};U.Create=function(b3,b4){return new U.New(b3,b4);};V.Default=function(){_1.$cctor();return _1.Default;};X=W.ArrayStorage=bS.Class({SSet:function(b3){return bL.ofSeq(b3);},SSetAt:function(b3,b4,b5){bL.set(b5,b3,b4);return b5;},SRemoveIf:function(b3,b4){var b5;return bL.filter((b5=function(b6){return!b6;},function(b6){return b5(b3(b6));}),b4);},SInit:function(){return this.init;},SPrependMany:function(b3,b4){var b5;b5=w.ofSeqNonCopying(b3);b4.unshift.apply(b4,b5);return b4;},SPrepend:function(b3,b4){b4.unshift(b3);return b4;},SAppendMany:function(b3,b4){var b5;b5=w.ofSeqNonCopying(b3);b4.push.apply(b4,b5);return b4;},SAppend:function(b3,b4){b4.push(b3);return b4;}},null,X);X.New=bS.Ctor(function(b3){this.init=b3;},X);Y=W.LocalStorageBackend=bS.Class({clear:function(){this.storage.removeItem(this.id);},set:function(b3){this.storage.setItem(this.id,h.stringify(bL.map(this.serializer.Encode,b3)));return b3;},SSet:function(b3){return this.set(bL.ofSeq(b3));},SSetAt:function(b3,b4,b5){bL.set(b5,b3,b4);return this.set(b5);},SRemoveIf:function(b3,b4){var b5;return this.set(bL.filter((b5=function(b6){return!b6;},function(b6){return b5(b3(b6));}),b4));},SInit:function(){var b3;b3=this.storage.getItem(this.id);if(b3===null)return[];else try{return bL.map(this.serializer.Decode,h.parse(b3));}catch(b4){return[];}},SPrependMany:function(b3,b4){var b5;b5=w.ofSeqNonCopying(b3);b4.unshift.apply(b4,b5);return this.set(b4);},SPrepend:function(b3,b4){b4.unshift(b3);return this.set(b4);},SAppendMany:function(b3,b4){var b5;b5=w.ofSeqNonCopying(b3);b4.push.apply(b4,b5);return this.set(b4);},SAppend:function(b3,b4){b4.push(b3);return this.set(b4);}},null,Y);Y.New=bS.Ctor(function(b3,b4){this.id=b3;this.serializer=b4;this.storage=window.localStorage;},Y);W.LocalStorage=function(b3,b4){return new Y.New(b3,b4);};W.InMemory=function(b3){return new X.New(b3);};Z=v.ListModel=bS.Class({Wrap:function(b3,b4,b5){return Z.Wrap(this,b3,b4,b5);},Lens:function(b3){return this.LensInto(g,function(b4,b5){return b5;},b3);},LensInto:function(b3,b4,b5){var b6,b7,b8;b6=this;b7=z.Id();b8=Q.Map(b3,this.FindByKeyAsView(b5));return{RGet:function(){return b3(b6.FindByKey(b5));},RSet:function(b9){return b6.UpdateBy(function(b_){return{$:1,$0:b4(b_,b9)};},b5);},RVal:function(){return this.RGet();},set_RVal:function(b9){return this.RSet(b9);},RUpd:function(b9){return b6.UpdateBy(function(b_){return{$:1,$0:b4(b_,b9(b3(b_)))};},b5);},RUpdM:function(b9){return b6.UpdateBy(function(b_){var b$;b$=b9(b3(b_));return b$==null?null:{$:1,$0:b4(b_,b$.$0)};},b5);},RView:function(){return b8;},RId:function(){return b7;}};},get_LengthAsView:function(){return Q.Map(bL.length,this["var"].RView());},get_Length:function(){return bL.length(this["var"].RVal());},Clear:function(){this["var"].set_RVal(this.storage.SSet([]));this.ObsoleteAll();},UpdateBy:function(b3,b4){var b5,b6,b7,b8,b9;b5=this;b6=this["var"].RVal();b7=bL.tryFindIndex(function(b_){return bT.Equals(b5.key(b_),b4);},b6);b7!=null&&b7.$==1?(b8=b7.$0,b9=b3(bL.get(b6,b8)),b9!=null&&b9.$==1?(this["var"].set_RVal(this.storage.SSetAt(b8,b9.$0,b6)),this.ObsoleteKey(b4)):void 0):void 0;},UpdateAll:function(b3){var b4;b4=this;this["var"].RUpd(function(b5){bL.iteri(function(b6,b7){var b8;b8=b3(b7);return b8==null?null:bL.set(b5,b6,b8.$0);},b5);return b4.storage.SSet(b5);});this.ObsoleteAll();},FindByKeyAsView:function(b3){return Q.Map(function(b4){return b4.$0;},this.TryFindByKeyAsView(b3));},TryFindByKeyAsView:function(b3){var b4;b4=this;return function(){var b5,b6,b7;b5=(b6=null,[b4.it.TryGetValue(b3,{get:function(){return b6;},set:function(b8){b6=b8;}}),b6]);return b5[0]?b5[1]:(b7=O.CreateWithValue(b4.TryFindByKey(b3)),(b4.it.Add(b3,b7),b7));};},TryFindByKey:function(b3){var b4;b4=this;return bL.tryFind(function(b5){return bT.Equals(b4.key(b5),b3);},this["var"].RVal());},FindByKey:function(b3){var b4;b4=this;return bL.find(function(b5){return bT.Equals(b4.key(b5),b3);},this["var"].RVal());},TryFindAsView:function(b3){return Q.Map(function(b4){return bL.tryFind(b3,b4);},this["var"].RView());},FindAsView:function(b3){return Q.Map(function(b4){return bL.find(b3,b4);},this["var"].RView());},TryFind:function(b3){return bL.tryFind(b3,this["var"].RVal());},Find:function(b3){return bL.find(b3,this["var"].RVal());},ContainsKeyAsView:function(b3){var b4,b5;b4=this;return Q.Map((b5=function(b6){return bT.Equals(b4.key(b6),b3);},function(b6){return bL.exists(b5,b6);}),this["var"].RView());},ContainsKey:function(b3){var b4;b4=this;return bL.exists(function(b5){return bT.Equals(b4.key(b5),b3);},this["var"].RVal());},Set:function(b3){this["var"].set_RVal(this.storage.SSet(b3));this.ObsoleteAll();},Iter:function(b3){bL.iter(b3,this["var"].RVal());},RemoveByKey:function(b3){var b4;b4=this;this["var"].set_RVal(this.storage.SRemoveIf(function(b5){return bT.Equals(b4.key(b5),b3);},this["var"].RVal()));this.ObsoleteKey(b3);},RemoveBy:function(b3){var b4,b5,b6,b7;b4=this["var"].RVal();for(b5=0,b6=b4.length-1;b5<=b6;b5++){b7=bL.get(b4,b5);b3(b7)?this.ObsoleteKey(this.key(b7)):void 0;}this["var"].set_RVal(this.storage.SRemoveIf(b3,this["var"].RVal()));},Remove:function(b3){var b4,b5,b6,b7;b4=this;b5=this["var"].RVal();_0.Contains(b4.key,b3,b5)?(b6=b4.key,b7=b6(b3),this["var"].set_RVal(this.storage.SRemoveIf(function(b8){return bT.Equals(b6(b8),b7);},b5)),this.ObsoleteKey(b7)):void 0;},PrependMany:function(b3){var b4,b5,b6;b4=this;b5=new bX.New$2();this["var"].set_RVal(this.storage.SPrependMany(b5,((b6=function(b7,b8){var b9,b_;b9=b4.key(b8);b4.ObsoleteKey(b9);b_=bL.tryFindIndex(function(b$){return bT.Equals(b4.key(b$),b9);},b7);return b_==null?(b5.Add(b8),b7):b4.storage.SSetAt(b_.$0,b8,b7);},(bS.Curried3(bR.fold))(b6))(this["var"].RVal()))(b3)));},Prepend:function(b3){var b4,b5,b6,b7;b4=this;b5=this["var"].RVal();b6=this.key(b3);b7=bL.tryFindIndex(function(b8){return bT.Equals(b4.key(b8),b6);},b5);b7!=null&&b7.$==1?this["var"].set_RVal(this.storage.SSetAt(b7.$0,b3,b5)):this["var"].set_RVal(this.storage.SPrepend(b3,b5));this.ObsoleteKey(b6);},AppendMany:function(b3){var b4,b5,b6;b4=this;b5=new bX.New$2();this["var"].set_RVal(this.storage.SAppendMany(b5,((b6=function(b7,b8){var b9,b_;b9=b4.key(b8);b4.ObsoleteKey(b9);b_=bL.tryFindIndex(function(b$){return bT.Equals(b4.key(b$),b9);},b7);return b_==null?(b5.Add(b8),b7):b4.storage.SSetAt(b_.$0,b8,b7);},(bS.Curried3(bR.fold))(b6))(this["var"].RVal()))(b3)));},Append:function(b3){var b4,b5,b6,b7;b4=this;b5=this["var"].RVal();b6=this.key(b3);b7=bL.tryFindIndex(function(b8){return bT.Equals(b4.key(b8),b6);},b5);b7!=null&&b7.$==1?this["var"].set_RVal(this.storage.SSetAt(b7.$0,b3,b5)):this["var"].set_RVal(this.storage.SAppend(b3,b5));this.ObsoleteKey(b6);},ObsoleteAll:function(){bR.iter(function(b3){O.MarkObsolete(b3.V);},this.it);this.it.Clear();},ObsoleteKey:function(b3){var b4,b5;b4=(b5=null,[this.it.TryGetValue(b3,{get:function(){return b5;},set:function(b6){b5=b6;}}),b5]);b4[0]?(O.MarkObsolete(b4[1]),this.it.Remove(b3)):void 0;},GetEnumerator0:function(){return bM.Get0(this["var"].RVal());},GetEnumerator:function(){return bM.Get(this["var"].RVal());}},null,Z);Z.New=bS.Ctor(function(b3,b4){Z.New$3.call(this,b3,P.Create$1(bL.ofSeq(bR.distinctBy(b3,b4.SInit()))),b4);},Z);Z.New$1=bS.Ctor(function(b3){Z.New$2.call(this,b3,[]);},Z);Z.New$2=bS.Ctor(function(b3,b4){var b5;b5=bL.ofSeq(b4);Z.New$3.call(this,b3,P.Create$1(b5),W.InMemory(b5));},Z);Z.New$3=bS.Ctor(function(b3,b4,b5){this.key=b3;this["var"]=b4;this.storage=b5;this.v=Q.Map(function(b6){return b6.slice();},this["var"].RView());this.it=new b0.New$5();},Z);_0.Contains=function(b3,b4,b5){var b6;b6=b3(b4);return bL.exists(function(b7){return bT.Equals(b3(b7),b6);},b5);};Z.Wrap=function(b3,b4,b5,b6){var b7,b8;b7=[new b0.New$5()];b8=bL.map(function(b9){var b_;b_=b5(b9);b7[0].set_Item(b3.key(b9),b_);return b_;},b3["var"].RVal());return new Z.New$3(function(b9){return b3.key(b4(b9));},P.Lens(b3["var"],function(b9){var b_,b$;b_=new b0.New$5();b$=bL.map(function(ca){var cb,cc;cb=b3.key(ca);cc=b7[0].ContainsKey(cb)?b6(b7[0].get_Item(cb),ca):b5(ca);b_.set_Item(cb,cc);return cc;},b9);b7[0]=b_;return b$;},function(b9,b_){var b$,ca;b$=new b0.New$5();ca=bL.map(function(cb){var cc;cc=b4(cb);b$.set_Item(b3.key(cc),cb);return cc;},b_);b7[0]=b$;return ca;}),W.InMemory(b8));};Z.FromSeq=function(b3){return Z.Create(g,b3);};Z.Create=function(b3,b4){return Z.CreateWithStorage(b3,W.InMemory(bL.ofSeq(b4)));};Z.CreateWithStorage=function(b3,b4){return new Z.New(b3,b4);};_1.$cctor=bS.Cctor(function(){_1.Default={Encode:g,Decode:g};_1.$cctor=window.ignore;});_2=v.ReactiveExtensions=bS.Class({},null,_2);_2.New=bS.Ctor(function(){},_2);_3=v.DoubleInterpolation=bS.Class({Interpolate:function(b3,b4,b5){return b4+b3*(b5-b4);}},null,_3);_3.DoubleInterpolation=new _3({$:0});_4.get_Double=function(){return _3.DoubleInterpolation;};_5=v.Easing=bS.Class({TransformTime:function(b3){return this.transformTime(b3);}},null,_5);_5.get_CubicInOut=function(){return _6.CubicInOut();};_5.Custom=function(b3){return new _5.New(b3);};_5.New=bS.Ctor(function(b3){this.transformTime=b3;},_5);_6.CubicInOut=function(){_.$cctor();return _.CubicInOut;};_7.get_Empty=function(){return{$:0,$0:H.Empty()};};_7.WhenDone=function(b3,b4){return _7.Append({$:0,$0:H.Single({$:0,$0:b3})},b4);};_7.Run=function(b3,b4){var b5,b6;b5=b4.Duration;b6=function(b7){function b8(b9,b_){var b$;b$=b_-b9;b4.Compute(b$);b3();return b$<=b5?void j(function(ca){b8(b9,ca);}):b7();}j(function(b9){b8(b9,b9);});};return bU.FromContinuations(function(b7,b8,b9){return b6.apply(null,[b7,b8,b9]);});};_7.Play=function(b3){var b4;b4=null;return bU.Delay(function(){return bU.Bind(_7.Run(function(){},_8.Actions(b3)),function(){_8.Finalize(b3);return bU.Return(null);});});};_7.Pack=function(b3){return{$:0,$0:H.Single({$:1,$0:b3})};};_7.Map=function(b3,b4){var b5;return _8.Def(b4.Duration,(b5=b4.Compute,function(b6){return b3(b5(b6));}));};_7.Delayed=function(b3,b4,b5,b6,b7,b8){return{Compute:function(b9){return b9<=b6?b7:b3.Interpolate(b4.TransformTime((b9-b6)/b5),b7,b8);},Duration:b5+b6};};_7.Simple=function(b3,b4,b5,b6,b7){return{Compute:function(b8){return b3.Interpolate(b4.TransformTime(b8/b5),b6,b7);},Duration:b5};};_7.Const=function(b3){return _8.Const(b3);};_7.Concat=function(b3){return{$:0,$0:H.Concat(bR.map(_8.List,b3))};};_7.Append=function(b3,b4){return{$:0,$0:H.Append(b3.$0,b4.$0)};};_7.set_UseAnimations=function(b3){_8.set_UseAnimations(b3);};_7.get_UseAnimations=function(){return _8.UseAnimations();};_8.UseAnimations=function(){_.$cctor();return _.UseAnimations;};_8.set_UseAnimations=function(b3){_.$cctor();_.UseAnimations=b3;};_8.Actions=function(b3){return _8.ConcatActions(bL.choose(function(b4){return b4.$==1?{$:1,$0:b4.$0}:null;},H.ToArray(b3.$0)));};_8.ConcatActions=function(b3){var b4,b5,b6,b7;b4=w.ofSeqNonCopying(b3);b5=bL.length(b4);return b5===0?_8.Const():b5===1?bL.get(b4,0):(b6=bR.max(bR.map(function(b8){return b8.Duration;},b4)),(b7=bL.map(function(b8){return _8.Prolong(b6,b8);},b4),_8.Def(b6,function(b8){bL.iter(function(b9){b9.Compute(b8);},b7);})));};_8.Prolong=function(b3,b4){var b5,b6,b7;b5=b4.Compute;b6=b4.Duration;b7=bZ.Create(function(){return b4.Compute(b4.Duration);});return{Compute:function(b8){return b8>=b6?b7.f():b5(b8);},Duration:b3};};_8.Const=function(b3){return _8.Def(0,function(){return b3;});};_8.Def=function(b3,b4){return{Compute:b4,Duration:b3};};_8.Finalize=function(b3){bL.iter(function(b4){if(b4.$==0)b4.$0();},H.ToArray(b3.$0));};_8.List=function(b3){return b3.$0;};_9=v.Trans=bS.Class({Copy:function(b3,b4,b5,b6){var b7,b8,b9,b_,b$,ca;b7=this;b8=(b9=function(cb,cc){return b7.TChange(cb,cc);},b3==null?function(cb){return function(cc){return b9(cb,cc);};}:b3.$0);return new _9.New$3(function(cb,cc){return(b8(cb))(cc);},(b_=this.get_TEnter(),b4==null?b_:b4.$0),(b$=this.get_TExit(),b5==null?b$:b5.$0),(ca=this.get_TFlags(),b6==null?ca:b6.$0));},get_TFlags:function(){return this.flags;},get_TExit:function(){return this.exit;},get_TEnter:function(){return this.enter;},TChange:function(b3,b4){return this.change(b3,b4);}},null,_9);_9.New=bS.Ctor(function(b3,b4,b5){_9.New$3.call(this,b3,bT.Equals(b4,null)?_7.Const:b4,bT.Equals(b5,null)?_7.Const:b5,1|(bT.Equals(b4,null)?0:2)|(bT.Equals(b5,null)?0:4));},_9);_9.New$1=bS.Ctor(function(b3){_9.New$3.call(this,b3,_7.Const,_7.Const,1);},_9);_9.New$2=bS.Ctor(function(){_9.New$3.call(this,function(b3,b4){return _7.Const(b4);},_7.Const,_7.Const,0);},_9);_9.New$3=bS.Ctor(function(b3,b4,b5,b6){this.change=b3;this.enter=b4;this.exit=b5;this.flags=b6;},_9);_9.Exit=function(b3,b4){return b4.Copy(null,null,{$:1,$0:b3},{$:1,$0:b4.get_TFlags()|4});};_9.Enter=function(b3,b4){return b4.Copy(null,{$:1,$0:b3},null,{$:1,$0:b4.get_TFlags()|2});};_9.Change=function(b3,b4){return b4.Copy({$:1,$0:b3},null,null,{$:1,$0:b4.get_TFlags()|1});};_9.Create=function(b3){return new _9.New$1(b3);};_9.Trivial=function(){return new _9.New$2();};_9.CanAnimateExit=function(b3){var b4,b5;b4=b3.get_TFlags();b5=4;return(b4&b5)===b5;};_9.CanAnimateEnter=function(b3){var b4,b5;b4=b3.get_TFlags();b5=2;return(b4&b5)===b5;};_9.CanAnimateChange=function(b3){var b4,b5;b4=b3.get_TFlags();b5=1;return(b4&b5)===b5;};_9.AnimateExit=function(b3,b4){return(b3.get_TExit())(b4);};_9.AnimateEnter=function(b3,b4){return(b3.get_TEnter())(b4);};_9.AnimateChange=function(b3,b4,b5){return b3.TChange(b4,b5);};_.$cctor=bS.Cctor(function(){_.CubicInOut=_5.Custom(function(b3){var b4;b4=b3*b3;return 3*b4-2*(b4*b3);});_.UseAnimations=true;_.$cctor=window.ignore;});$=v.AnimatedAttrNode=bS.Class({sync:function(b3){var b4;if(this.dirty){b4=this.logical;b4==null?void 0:(this.push(b3))(b4.$0);this.visible=this.logical;this.dirty=false;}},pushVisible:function(b3,b4){this.visible={$:1,$0:b4};this.dirty=true;(this.push(b3))(b4);},NChanged:function(){return this.updates;},NSync:function(b3){},NGetExitAnim:function(b3){var b4,b5;b4=this;return _7.WhenDone(function(){b4.dirty=true;b4.visible=null;},(b5=this.visible,b5!=null&&b5.$==1?_7.Pack(_7.Map(function(b6){b4.pushVisible(b3,b6);},_9.AnimateExit(this.tr,b5.$0))):_7.get_Empty()));},NGetEnterAnim:function(b3){var b4,b5,b6,b7,b8;b4=this;return _7.WhenDone(function(){b4.sync(b3);},(b5=this.visible,(b6=this.logical,b5!=null&&b5.$==1&&(b6!=null&&b6.$==1&&(this.dirty&&(b7=[b6.$0,b5.$0],true)))?_7.Pack(_7.Map(function(b9){b4.pushVisible(b3,b9);},_9.AnimateChange(this.tr,b7[1],b7[0]))):b5==null&&(b6!=null&&b6.$==1&&true)?_7.Pack(_7.Map(function(b9){b4.pushVisible(b3,b9);},_9.AnimateEnter(this.tr,b6.$0))):_7.get_Empty())));},NGetChangeAnim:function(b3){var b4,b5,b6,b7;b4=this;return _7.WhenDone(function(){b4.sync(b3);},(b5=this.visible,(b6=this.logical,b5!=null&&b5.$==1&&(b6!=null&&b6.$==1&&(this.dirty&&(b7=[b6.$0,b5.$0],true)))?_7.Pack(_7.Map(function(b8){b4.pushVisible(b3,b8);},_9.AnimateChange(this.tr,b7[1],b7[0]))):_7.get_Empty())));}},null,$);$.New=bS.Ctor(function(b3,b4,b5){var b6;b6=this;this.tr=b3;this.push=b5;this.logical=null;this.visible=null;this.dirty=true;this.updates=Q.Map(function(b7){b6.logical={$:1,$0:b7};b6.dirty=true;},b4);},$);ba=v.DynamicAttrNode=bS.Class({NChanged:function(){return this.updates;},NSync:function(b3){if(this.dirty){(this.push(b3))(this.value);this.dirty=false;}},NGetExitAnim:function(b3){return _7.get_Empty();},NGetEnterAnim:function(b3){return _7.get_Empty();},NGetChangeAnim:function(b3){return _7.get_Empty();}},null,ba);ba.New=bS.Ctor(function(b3,b4){var b5;b5=this;this.push=b4;this.value=void 0;this.dirty=false;this.updates=Q.Map(function(b6){b5.value=b6;b5.dirty=true;},b3);},ba);bb=v.AttrProxy=bS.Class({},null,bb);bb.Handler=function(b3,b4){return bf.Static(function(b5){b5.addEventListener(b3,function(b6){return(b4(b5))(b6);},false);});};bb.Concat=function(b3){var b4;b4=w.ofSeqNonCopying(b3);return w.TreeReduce(bf.EmptyAttr(),bb.Append,b4);};bb.Append=function(b3,b4){return bf.AppendTree(b3,b4);};bb.Create=function(b3,b4){return bf.Static(function(b5){J.SetAttr(b5,b3,b4);});};be.New=function(b3,b4,b5,b6){var b7;b7={DynElem:b3,DynFlags:b4,DynNodes:b5};bS.SetOptional(b7,"OnAfterRender",b6);return b7;};bf.Static=function(b3){return new bb({$:3,$0:b3});};bf.Dynamic=function(b3,b4){return new bb({$:1,$0:new ba.New(b3,b4)});};bf.Animated=function(b3,b4,b5){var b6,b7,b8;b6=new $.New(b3,b4,b5);b7=4;_9.CanAnimateEnter(b3)?b7=b7|1:void 0;_9.CanAnimateExit(b3)?b7=b7|2:void 0;b8=new bb({$:1,$0:b6});bf.SetFlags(b8,b7);return b8;};bf.EmptyAttr=function(){bi.$cctor();return bi.EmptyAttr;};bf.AppendTree=function(b3,b4){var b5;return b3===null?b4:b4===null?b3:(b5=new bb({$:2,$0:b3,$1:b4}),(bf.SetFlags(b5,bf.Flags(b3)|bf.Flags(b4)),b5));};bf.GetChangeAnim=function(b3){return bf.GetAnim(b3,function(b4,b5){return b4.NGetChangeAnim(b5);});};bf.GetExitAnim=function(b3){return bf.GetAnim(b3,function(b4,b5){return b4.NGetExitAnim(b5);});};bf.GetEnterAnim=function(b3){return bf.GetAnim(b3,function(b4,b5){return b4.NGetEnterAnim(b5);});};bf.GetAnim=function(b3,b4){return _7.Concat(bL.map(function(b5){return b4(b5,b3.DynElem);},b3.DynNodes));};bf.Updates=function(b3){return w.MapTreeReduce(function(b4){return b4.NChanged();},Q.Const(),Q.Map2Unit,b3.DynNodes);};bf.Empty=function(b3){return be.New(b3,0,[],null);};bf.Insert=function(b3,b4){var b5,b6,b7;function b8(b9){if(!(b9===null))if(b9!=null&&b9.$==1)b5.push(b9.$0);else if(b9!=null&&b9.$==2){b8(b9.$0);b8(b9.$1);}else if(b9!=null&&b9.$==3)b9.$0(b3);else if(b9!=null&&b9.$==4)b6.push(b9.$0);}b5=[];b6=[];b8(b4);b7=b5.slice(0);return be.New(b3,bf.Flags(b4),b7,b6.length===0?null:{$:1,$0:function(b9){bR.iter(function(b_){b_(b9);},b6);}});};bf.Sync=function(b3,b4){bL.iter(function(b5){b5.NSync(b3);},b4.DynNodes);};bf.SetFlags=function(b3,b4){b3.flags=b4;};bf.Flags=function(b3){return b3!==null&&b3.hasOwnProperty("flags")?b3.flags:0;};bf.HasExitAnim=function(b3){var b4;b4=2;return(b3.DynFlags&b4)===b4;};bf.HasEnterAnim=function(b3){var b4;b4=1;return(b3.DynFlags&b4)===b4;};bf.HasChangeAnim=function(b3){var b4;b4=4;return(b3.DynFlags&b4)===b4;};bg=v.CheckedInput=bS.Class({get_Input:function(){return this.$==1?this.$0:this.$==2?this.$0:this.$1;}},null,bg);bg.Make=function(b3){return new bg({$:0,$0:b3,$1:b(b3)});};bh.ValidateForm=function(){return bh.OnAfterRender(function(b3){if(f)f.setup(b3);});};bh.Checked=function(b3){var b4;b4=function(b5){return!bT.Equals(b3.RVal(),b5.checked)?b3.set_RVal(b5.checked):null;};return bb.Concat([bh.DynamicProp("checked",b3.RView()),bh.Handler("change",function(b5){return function(b6){return b4(b5,b6);};}),bh.Handler("click",function(b5){return function(b6){return b4(b5,b6);};})]);};bh.FloatValue=function(b3){return bh.CustomVar(b3,function(b4,b5){var b6;b6=b5.get_Input();return b4.value!==b6?void(b4.value=b6):null;},function(b4){var b5,b6;b5=b4.value;return{$:1,$0:x.isBlank(b5)?(b4.checkValidity?b4.checkValidity():true)?new bg({$:2,$0:b5}):new bg({$:1,$0:b5}):(b6=+b5,k(b6)?new bg({$:1,$0:b5}):new bg({$:0,$0:b6,$1:b5}))};});};bh.FloatValueUnchecked=function(b3){return bh.CustomValue(b3,b,function(b4){var b5;return x.isBlank(b4)?{$:1,$0:0}:(b5=+b4,k(b5)?null:{$:1,$0:b5});});};bh.IntValue=function(b3){return bh.CustomVar(b3,function(b4,b5){var b6;b6=b5.get_Input();return b4.value!==b6?void(b4.value=b6):null;},function(b4){var b5,b6,b7;b5=b4.value;return{$:1,$0:x.isBlank(b5)?(b4.checkValidity?b4.checkValidity():true)?new bg({$:2,$0:b5}):new bg({$:1,$0:b5}):(b6=(b7=0,[b1.TryParseInt32(b5,{get:function(){return b7;},set:function(b8){b7=b8;}}),b7]),b6[0]?new bg({$:0,$0:b6[1],$1:b5}):new bg({$:1,$0:b5}))};});};bh.IntValueUnchecked=function(b3){return bh.CustomValue(b3,b,function(b4){var b5;return x.isBlank(b4)?{$:1,$0:0}:(b5=+b4,b5!==b5>>0?null:{$:1,$0:b5});});};bh.Value=function(b3){var b4,b5;return bh.CustomValue(b3,g,(b4=g,(b5=function(b6){return{$:1,$0:b6};},function(b6){return b5(b4(b6));})));};bh.ContentEditableHtml=function(b3){var b4;b4=bh.CustomVar(b3,function(b5,b6){b5.innerHTML=b6;},function(b5){return{$:1,$0:b5.innerHTML};});return bb.Append(bb.Create("contenteditable","true"),b4);};bh.ContentEditableText=function(b3){var b4;b4=bh.CustomVar(b3,function(b5,b6){b5.textContent=b6;},function(b5){return{$:1,$0:b5.textContent};});return bb.Append(bb.Create("contenteditable","true"),b4);};bh.CustomValue=function(b3,b4,b5){return bh.CustomVar(b3,function(b6,b7){b6.value=b4(b7);},function(b6){return b5(b6.value);});};bh.CustomVar=function(b3,b4,b5){var b6,b7;b6=function(b8){return b3.RUpdM(function(b9){var b_,b$;b_=b5(b8);return b_!=null&&b_.$==1&&(!bT.Equals(b_.$0,b9)&&(b$=[b_,b_.$0],true))?b$[0]:null;});};b7=function(b8,b9){var b_,b$;b_=b5(b8);return b_!=null&&b_.$==1&&(bT.Equals(b_.$0,b9)&&(b$=b_.$0,true))?null:b4(b8,b9);};return bb.Concat([bh.Handler("change",function(b8){return function(b9){return b6(b8,b9);};}),bh.Handler("input",function(b8){return function(b9){return b6(b8,b9);};}),bh.Handler("keypress",function(b8){return function(b9){return b6(b8,b9);};}),bh.DynamicCustom(function(b8){return function(b9){return b7(b8,b9);};},b3.RView())]);};bh.DynamicProp=function(b3,b4){return bf.Dynamic(b4,function(b5){return function(b6){b5[b3]=b6;};});};bh.DynamicPred=function(b3,b4,b5){var b6;b6=function(b7,b8){return b8[0]?J.SetAttr(b7,b3,b8[1]):J.RemoveAttr(b7,b3);};return bf.Dynamic(Q.Map2(function(b7,b8){return[b7,b8];},b4,b5),function(b7){return function(b8){return b6(b7,b8);};});};bh.DynamicClass=function(b3,b4,b5){return bf.Dynamic(b4,function(b6){return function(b7){return b5(b7)?J.AddClass(b6,b3):J.RemoveClass(b6,b3);};});};bh.OnAfterRenderView=function(b3,b4){var b5;b5=z.Id();return bb.Append(bh.OnAfterRender(function(b6){b4(b6,b6[b5]);}),bh.DynamicCustom(function(b6){return function(b7){b6[b5]=b7;};},b3));};bh.OnAfterRender=function(b3){return new bb({$:4,$0:b3});};bh.HandlerView=function(b3,b4,b5){return bf.Static(function(b6){var b7;b7=b5(b6);b6.addEventListener(b3,function(b8){return Q.Get(b7(b8),b4);},false);});};bh.Handler=function(b3,b4){return bf.Static(function(b5){b5.addEventListener(b3,function(b6){return(b4(b5))(b6);},false);});};bh.DynamicStyle=function(b3,b4){return bf.Dynamic(b4,function(b5){return function(b6){return J.SetStyle(b5,b3,b6);};});};bh.DynamicCustom=function(b3,b4){return bf.Dynamic(b4,b3);};bh.Dynamic=function(b3,b4){return bf.Dynamic(b4,function(b5){return function(b6){return J.SetAttr(b5,b3,b6);};});};bh.AnimatedStyle=function(b3,b4,b5,b6){return bf.Animated(b4,b5,function(b7){return function(b8){return J.SetStyle(b7,b3,b6(b8));};});};bh.Animated=function(b3,b4,b5,b6){return bf.Animated(b4,b5,function(b7){return function(b8){return J.SetAttr(b7,b3,b6(b8));};});};bh.Class=function(b3){return bf.Static(function(b4){J.AddClass(b4,b3);});};bh.Style=function(b3,b4){return bf.Static(function(b5){J.SetStyle(b5,b3,b4);});};bi.$cctor=bS.Cctor(function(){bi.EmptyAttr=null;bi.$cctor=window.ignore;});bj.EmptyDoc={$:3};bk=v.DocElemNode=bS.Class({GetHashCode:function(){return this.ElKey;},Equals:function(b3){return this.ElKey===b3.ElKey;}},null,bk);bk.New=function(b3,b4,b5,b6,b7,b8){var b9;return new bk((b9={Attr:b3,Children:b4,El:b6,ElKey:b7},(bS.SetOptional(b9,"Delimiters",b5),bS.SetOptional(b9,"Render",b8),b9)));};bm.FoldBack=function(b3,b4,b5){return bL.foldBack(b3,b4.$0,b5);};bm.Iter=function(b3,b4){bL.iter(b3,b4.$0);};bm.Except=function(b3,b4){var b5;b5=b3.$0;return{$:0,$0:bL.filter(function(b6){return bL.forall(function(b7){return!(b6===b7);},b5);},b4.$0)};};bm.DocChildren=function(b3){var b4;function b5(b6){if(b6.$==2)b5(b6.$0.Current);else if(b6.$==1)b4.push(b6.$0.El);else if(b6.$==3);else if(b6.$==5)b4.push(b6.$0);else if(b6.$==4)b4.push(b6.$0.Text);else if(b6.$==6)bL.iter(function(b7){if(b7.constructor===l)b5(b7);else b4.push(b7);},b6.$0.Els);else{b5(b6.$0);b5(b6.$1);}}b4=[];b5(b3.Children);return{$:0,$0:w.ofSeqNonCopying(b4)};};bm.Children=function(b3,b4){var b5,b6,b7;if(b4!=null&&b4.$==1){b7=[];b5=b4.$0[0].nextSibling;while(b5!==b4.$0[1]){b7.push(b5);b5=b5.nextSibling;}return{$:0,$0:b7};}else return{$:0,$0:bL.init(b3.childNodes.length,(b6=b3.childNodes,function(b8){return b6[b8];}))};};bn.ToArray=function(b3){return A.ToArray(b3.$0);};bn.get_Empty=function(){return{$:0,$0:new bQ.New$3()};};bn.IsEmpty=function(b3){return b3.$0.get_Count()===0;};bn.Intersect=function(b3,b4){return{$:0,$0:A.Intersect(b3.$0,b4.$0)};};bn.Except=function(b3,b4){return{$:0,$0:A.Except(b3.$0,b4.$0)};};bn.FindAll=function(b3){var b4;function b5(b7){if(b7.$==0){b5(b7.$0);b5(b7.$1);}else if(b7.$==1)b6(b7.$0);else if(b7.$==2)b5(b7.$0.Current);else if(b7.$==6)bL.iter(b6,b7.$0.Holes);}function b6(b7){b4.push(b7);b5(b7.Children);}b4=[];b5(b3);return{$:0,$0:new bQ.New$2(b4)};};bn.Filter=function(b3,b4){return{$:0,$0:A.Filter(b3,b4.$0)};};bo.New=function(b3,b4){return{PreviousNodes:b3,Top:b4};};bp.TextHoleRE=function(){bt.$cctor();return bt.TextHoleRE;};bp.LoadedTemplates=function(){bt.$cctor();return bt.LoadedTemplates;};bp.UpdateTextNode=function(b3,b4){b3.Value=b4;b3.Dirty=true;};bp.CreateTextNode=function(){return{Text:J.CreateText(""),Dirty:false,Value:""};};bp.UpdateEmbedNode=function(b3,b4){b3.Current=b4;b3.Dirty=true;};bp.CreateEmbedNode=function(){return{Current:bj.EmptyDoc,Dirty:false};};bp.PerformAnimatedUpdate=function(b3,b4){var b5,b6;return _7.get_UseAnimations()?(b5=null,bU.Delay(function(){var b7,b8,b9;b7=bn.FindAll(b4);b8=bp.ComputeChangeAnim(b3,b7);b9=bp.ComputeEnterAnim(b3,b7);return bU.Bind(_7.Play(_7.Append(b8,bp.ComputeExitAnim(b3,b7))),function(){bp.SyncElemNode(b3.Top);return bU.Bind(_7.Play(b9),function(){b3.PreviousNodes=b7;return bU.Return(null);});});})):(b6=function(b7){j(function(){bp.SyncElemNode(b3.Top);b7();});},bU.FromContinuations(function(b7,b8,b9){return b6.apply(null,[b7,b8,b9]);}));};bp.ComputeEnterAnim=function(b3,b4){return _7.Concat(bL.map(function(b5){return bf.GetEnterAnim(b5.Attr);},bn.ToArray(bn.Except(b3.PreviousNodes,bn.Filter(function(b5){return bf.HasEnterAnim(b5.Attr);},b4)))));};bp.ComputeChangeAnim=function(b3,b4){var b5,b6;b5=(b6=function(b7){return bf.HasChangeAnim(b7.Attr);},function(b7){return bn.Filter(b6,b7);});return _7.Concat(bL.map(function(b7){return bf.GetChangeAnim(b7.Attr);},bn.ToArray(bn.Intersect(b5(b3.PreviousNodes),b5(b4)))));};bp.ComputeExitAnim=function(b3,b4){return _7.Concat(bL.map(function(b5){return bf.GetExitAnim(b5.Attr);},bn.ToArray(bn.Except(b4,bn.Filter(function(b5){return bf.HasExitAnim(b5.Attr);},b3.PreviousNodes)))));};bp.CreateDelimitedRunState=function(b3,b4,b5){return bo.New(bn.get_Empty(),bp.CreateDelimitedElemNode(b3,b4,bf.EmptyAttr(),b5));};bp.CreateRunState=function(b3,b4){return bo.New(bn.get_Empty(),bp.CreateElemNode(b3,bf.EmptyAttr(),b4));};bp.CreateDelimitedElemNode=function(b3,b4,b5,b6){var b7,b8;b7=b3.parentNode;bp.LinkPrevElement(b4,b6);b8=bf.Insert(b7,b5);return bk.New(b8,b6,{$:1,$0:[b3,b4]},b7,z.Int(),bS.GetOptional(b8.OnAfterRender));};bp.CreateElemNode=function(b3,b4,b5){var b6;bp.LinkElement(b3,b5);b6=bf.Insert(b3,b4);return bk.New(b6,b5,null,b3,z.Int(),bS.GetOptional(b6.OnAfterRender));};bp.SyncElemNode=function(b3){bp.SyncElement(b3);bp.Sync(b3.Children);bp.AfterRender(b3);};bp.Sync=function(b3){var b4,b5;if(b3.$==1)bp.SyncElemNode(b3.$0);else if(b3.$==2)bp.Sync(b3.$0.Current);else if(b3.$==3);else if(b3.$==5);else if(b3.$==4){b4=b3.$0;b4.Dirty?(b4.Text.nodeValue=b4.Value,b4.Dirty=false):void 0;}else if(b3.$==6){b5=b3.$0;bL.iter(function(b6){bp.SyncElemNode(b6);},b5.Holes);bL.iter(function(b6){bf.Sync(b6[0],b6[1]);},b5.Attrs);bp.AfterRender(b5);}else{bp.Sync(b3.$0);bp.Sync(b3.$1);}};bp.AfterRender=function(b3){var b4;b4=bS.GetOptional(b3.Render);b4!=null&&b4.$==1?(b4.$0(b3.El),bS.SetOptional(b3,"Render",null)):void 0;};bp.InsertBeforeDelim=function(b3,b4){var b5,b6;b5=b3.parentNode;b6=e.createTextNode("");b5.insertBefore(b6,b3);bp.LinkPrevElement(b3,b4);return b6;};bp.LinkPrevElement=function(b3,b4){bp.InsertDoc(b3.parentNode,b4,b3);};bp.LinkElement=function(b3,b4){bp.InsertDoc(b3,b4,null);};bp.SyncElement=function(b3){function b4(b5){function b6(b7){var b8,b9;return b7.$==0?b6(b7.$0)||b6(b7.$1):b7.$==2?(b8=b7.$0,b8.Dirty||b6(b8.Current)):b7.$==6&&(b9=b7.$0,b9.Dirty||bL.exists(b4,b9.Holes));}return b6(b5.Children);}bf.Sync(b3.El,b3.Attr);b4(b3)?bp.DoSyncElement(b3):void 0;};bp.DoSyncElement=function(b3){var b4,b5,b6;function b7(b8,b9){var b_,b$;return b8.$==1?b8.$0.El:b8.$==2?(b_=b8.$0,b_.Dirty?(b_.Dirty=false,bp.InsertDoc(b4,b_.Current,b9)):b7(b_.Current,b9)):b8.$==3?b9:b8.$==4?b8.$0.Text:b8.$==5?b8.$0:b8.$==6?(b$=b8.$0,(b$.Dirty?b$.Dirty=false:void 0,bL.foldBack(function(ca,cb){return ca.constructor===l?b7(ca,cb):ca;},b$.Els,b9))):b7(b8.$0,b7(b8.$1,b9));}b4=b3.El;bm.Iter((b5=b3.El,function(b8){J.RemoveNode(b5,b8);}),bm.Except(bm.DocChildren(b3),bm.Children(b3.El,bS.GetOptional(b3.Delimiters))));b7(b3.Children,(b6=bS.GetOptional(b3.Delimiters),b6!=null&&b6.$==1?b6.$0[1]:null));};bp.InsertDoc=function(b3,b4,b5){var b6;return b4.$==1?bp.InsertNode(b3,b4.$0.El,b5):b4.$==2?(b6=b4.$0,(b6.Dirty=false,bp.InsertDoc(b3,b6.Current,b5))):b4.$==3?b5:b4.$==4?bp.InsertNode(b3,b4.$0.Text,b5):b4.$==5?bp.InsertNode(b3,b4.$0,b5):b4.$==6?bL.foldBack(function(b7,b8){return b7.constructor===l?bp.InsertDoc(b3,b7,b8):bp.InsertNode(b3,b7,b8);},b4.$0.Els,b5):bp.InsertDoc(b3,b4.$0,bp.InsertDoc(b3,b4.$1,b5));};bp.InsertNode=function(b3,b4,b5){J.InsertAt(b3,b5,b4);return b4;};bq=v.Doc=bS.Class({ReplaceInDom:function(b3){var b4;b4=e.createTextNode("");b3.parentNode.replaceChild(b4,b3);bq.RunBefore(b4,this);}},null,bq);bq.Append=function(b3,b4){return bq.Mk({$:0,$0:b3.docNode,$1:b4.docNode},Q.Map2Unit(b3.updates,b4.updates));};bq.Concat=function(b3){var b4;b4=w.ofSeqNonCopying(b3);return w.TreeReduce(bq.Empty(),bq.Append,b4);};bq.Empty=function(){return bq.Mk(bj.EmptyDoc,Q.Const());};bq.TextNode=function(b3){return bq.Mk({$:5,$0:J.CreateText(b3)},Q.Const());};bq.Verbatim=function(b3){var b4;return bq.Mk(w.MapTreeReduce(function(b5){return bT.Equals(b5.nodeType,m.TEXT_NODE)?{$:5,$0:b5}:{$:1,$0:bp.CreateElemNode(b5,bf.EmptyAttr(),bj.EmptyDoc)};},bj.EmptyDoc,function(b5,b6){return{$:0,$0:b5,$1:b6};},(b4=d.parseHTML(b3),bT.Equals(b4,null)?[]:b4)),Q.Const());};bq.SvgElementMixed=function(b3,b4){var b5;b5=bq.MixedNodes(b4);return bq.SvgElement(b3,b5[0],b5[1]);};bq.SvgElement=function(b3,b4,b5){var b6,b7;b6=bb.Concat(b4);b7=bq.Concat(b5);return br.New(J.CreateSvgElement(b3),b6,b7);};bq.ElementMixed=function(b3,b4){var b5;b5=bq.MixedNodes(b4);return bq.Element(b3,b5[0],b5[1]);};bq.ConcatMixed=function(b3){return bq.Concat(bR.map(bq.ToMixedDoc,b3));};bq.MixedNodes=function(b3){var b4,b5,b6,b7;b4=new bX.New$2();b5=new bX.New$2();b6=bM.Get(b3);try{while(b6.MoveNext()){b7=b6.Current();b7 instanceof bb?b4.Add(b7):b5.Add(bq.ToMixedDoc(b7));}}finally{if("Dispose"in b6)b6.Dispose();}return[b4,b5];};bq.ToMixedDoc=function(b3){return b3 instanceof bq?b3:typeof b3=="string"?bq.TextNode(b3):b3 instanceof n?bq.Static(b3):typeof b3=="function"?bq.EmbedView(Q.Map(bq.ToMixedDoc,b3)):b3 instanceof P?bq.EmbedView(Q.Map(bq.ToMixedDoc,b3.v)):bT.Equals(b3,null)?bq.Empty():bq.TextNode(b(b3));};bq.Element=function(b3,b4,b5){var b6,b7;b6=bb.Concat(b4);b7=bq.Concat(b5);return br.New(J.CreateElement(b3),b6,b7);};bq.Radio=function(b3,b4,b5){var b6,b7;b6=J.CreateElement("input");b6.addEventListener("click",function(){return b5.RSet(b4);},false);b7=bh.DynamicProp("checked",Q.Map(function(b8){return bT.Equals(b8,b4);},b5.RView()));return br.New(b6,bb.Concat(bK.append(bK.ofArray([bb.Create("type","radio"),bb.Create("name",b5.RId()),b7]),bK.ofSeq(b3))),bq.Empty());};bq.LinkView=function(b3,b4,b5,b6){var b7;b7=bb.Concat(bR.append([bh.HandlerView("click",b5,function(){return function(){return b6;};}),bb.Create("href","#")],b4));return br.New(J.CreateElement("a"),b7,bq.TextNode(b3));};bq.Link=function(b3,b4,b5){var b6,b7;b6=(b7=bb.Concat(b4),bb.Append(bb.Create("href","#"),b7));return br.New(bq.Clickable("a",b5),b6,bq.TextNode(b3));};bq.ButtonView=function(b3,b4,b5,b6){var b7;b7=bb.Concat(bR.append([bh.HandlerView("click",b5,function(){return function(){return b6;};})],b4));return br.New(J.CreateElement("button"),b7,bq.TextNode(b3));};bq.Button=function(b3,b4,b5){var b6;b6=bb.Concat(b4);return br.New(bq.Clickable("button",b5),b6,bq.TextNode(b3));};bq.Clickable=function(b3,b4){var b5;b5=J.CreateElement(b3);b5.addEventListener("click",function(b6){b6.preventDefault();return b4();},false);return b5;};bq.CheckBoxGroup=function(b3,b4,b5){var b6;return bq.CheckBox(b3,P.Lens(b5,(b6=function(b7){return bT.Equals(b4,b7);},function(b7){return bK.exists(b6,b7);}),function(b7,b8){return b8?bK.exists(function(b9){return bT.Equals(b4,b9);},b7)?b7:new bK.T({$:1,$0:b4,$1:b7}):bK.filter(function(b9){return!bT.Equals(b4,b9);},b7);}));};bq.CheckBox=function(b3,b4){return bq.InputInternal("input",function(){return bR.append(b3,[bb.Create("type","checkbox"),bh.Checked(b4)]);});};bq.SelectDynOptional=function(b3,b4,b5,b6,b7){return bq.SelectDyn(b3,function(b8){return b8!=null&&b8.$==1?b5(b8.$0):b4;},Q.Map(function(b8){return new bK.T({$:1,$0:null,$1:bK.map(function(b9){return{$:1,$0:b9};},b8)});},b6),b7);};bq.SelectOptional=function(b3,b4,b5,b6,b7){return bq.Select(b3,function(b8){return b8!=null&&b8.$==1?b5(b8.$0):b4;},new bK.T({$:1,$0:null,$1:bK.map(function(b8){return{$:1,$0:b8};},b6)}),b7);};bq.Select=function(b3,b4,b5,b6){return bq.SelectImpl(b3,b4,function(b7){b7[0]=b5;return bq.Concat(bK.mapi(function(b8,b9){return bq.Element("option",bK.ofArray([bb.Create("value",b(b8))]),bK.ofArray([bq.TextNode(b4(b9))]));},b5));},b6);};bq.SelectDyn=function(b3,b4,b5,b6){return bq.SelectImpl(b3,b4,function(b7){var b8;b8=function(b9,b_){return bq.Element("option",bK.ofArray([bb.Create("value",b(b9))]),bK.ofArray([bq.TextNode(b4(b_))]));};return bq.Convert(function(b9){return b8(b9[0],b9[1]);},Q.Map(function(b9){b7[0]=b9;return bR.mapi(function(b_,b$){return[b_,b$];},b9);},b5));},b6);};bq.SelectImpl=function(b3,b4,b5,b6){var b7,b8,b9,b_,b$,ca,cb,cc,cd;b7=[bK.T.Empty];b8=function(ce){return ce.selectedIndex;};b9=function(ce,cf){ce.selectedIndex=cf;};b_=function(ce){var cf;cf=b8(ce);return b7[0].get_Item(cf);};b$=function(ce){return bR.findIndex(function(cf){return bT.Equals(ce,cf);},b7[0]);};ca=function(ce,cf){return b9(ce,b$(cf));};cb=J.CreateElement("select");cc=bh.DynamicCustom(function(ce){return function(cf){return ca(ce,cf);};},b6.RView());cb.addEventListener("change",function(){b6.RUpdM(function(ce){var cf;cf=b_(cb);return bT.Equals(ce,cf)?null:{$:1,$0:cf};});},false);return br.New(cb,(cd=bb.Append(cc,bb.Concat(b3)),bb.Append(bh.OnAfterRender(function(ce){ca(ce,b6.RGet());}),cd)),b5(b7));};bq.InputArea=function(b3,b4){return bq.InputInternal("textarea",function(){return bR.append(b3,[bh.Value(b4)]);});};bq.FloatInput=function(b3,b4){return bq.InputInternal("input",function(){return bR.append(b3,[bh.FloatValue(b4),bb.Create("type","number")]);});};bq.FloatInputUnchecked=function(b3,b4){return bq.InputInternal("input",function(){return bR.append(b3,[b4.RGet()===0?bb.Create("value","0"):bf.EmptyAttr(),bh.FloatValueUnchecked(b4),bb.Create("type","number")]);});};bq.IntInput=function(b3,b4){return bq.InputInternal("input",function(){return bR.append(b3,[bh.IntValue(b4),bb.Create("type","number")]);});};bq.IntInputUnchecked=function(b3,b4){return bq.InputInternal("input",function(){return bR.append(b3,[b4.RGet()===0?bb.Create("value","0"):bf.EmptyAttr(),bh.IntValueUnchecked(b4),bb.Create("type","number")]);});};bq.PasswordBox=function(b3,b4){return bq.InputInternal("input",function(){return bR.append(b3,[bh.Value(b4),bb.Create("type","password")]);});};bq.Input=function(b3,b4){return bq.InputInternal("input",function(){return bR.append(b3,[bh.Value(b4)]);});};bq.InputInternal=function(b3,b4){var b5;b5=J.CreateElement(b3);return br.New(b5,bb.Concat(b4(b5)),bq.Empty());};bq.ConvertSeqBy=function(b3,b4,b5){return bq.Flatten(Q.MapSeqCachedViewBy(b3,function(b6,b7){return(b4(b6))(b7);},b5));};bq.ConvertSeq=function(b3,b4){return bq.Flatten(Q.MapSeqCachedView(b3,b4));};bq.ConvertBy=function(b3,b4,b5){return bq.Flatten(Q.MapSeqCachedBy(b3,b4,b5));};bq.Convert=function(b3,b4){return bq.Flatten(Q.MapSeqCached(b3,b4));};bq.Flatten=function(b3){return bq.EmbedView(Q.Map(bq.Concat,b3));};bq.GetOrLoadTemplate=function(b3,b4,b5,b6){bq.PrepareTemplate(b3,b4,b5);return bq.NamedTemplate(b3,b4,b6);};bq.NamedTemplate=function(b3,b4,b5){var b6,b7,b8;b6=bq.ComposeName(b3,b4);b7=(b8=null,[bp.LoadedTemplates().TryGetValue(b6,{get:function(){return b8;},set:function(b9){b8=b9;}}),b8]);return b7[0]?bq.ChildrenTemplate(b7[1].cloneNode(true),b5):(c.warn("Local template doesn't exist",b6),bq.Empty());};bq.LoadLocalTemplates=function(b3){(function(){var b4,b5,b6,b7;while(true){b4=e.querySelector("[ws-template]");if(bT.Equals(b4,null)){b5=e.querySelector("[ws-children-template]");if(bT.Equals(b5,null))return null;else{b6=b5.getAttribute("ws-children-template");b5.removeAttribute("ws-children-template");bq.PrepareTemplate(b3,{$:1,$0:b6},function(b8){return function(){return J.ChildrenArray(b8);};}(b5));}}else{b7=b4.getAttribute("ws-template");bq.PrepareSingleTemplate(b3,{$:1,$0:b7},b4);}}}());};bq.PrepareTemplate=function(b3,b4,b5){var b6,b7,b8,b9,b_;if(!bp.LoadedTemplates().ContainsKey(bq.ComposeName(b3,b4))){b6=b5();for(b7=0,b8=b6.length-1;b7<=b8;b7++){b9=bL.get(b6,b7);b_=b9.parentNode;bT.Equals(b_,null)?void 0:b_.removeChild(b9);}bq.PrepareTemplateStrict(b3,b4,b6);}};bq.PrepareTemplateStrict=function(b3,b4,b5){var b6,b7,b8,b9,b_,b$,ca,cb;function cc(ch,ci,cj){var ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG;while(true)switch(ch){case 0:co=b2.string(ci.nodeName,{$:1,$0:3},null).toLowerCase();cp=co.indexOf(b.fromCharCode(46))===-1?b3+"/"+co:bN.Replace(co,".","/");if(!bp.LoadedTemplates().ContainsKey(cp))return c.warn("Instantiating non-loaded template",cp);else{cq=bp.LoadedTemplates().get_Item(cp);cr=cq.cloneNode(true);cs=new bQ.New$3();ct=new b0.New$5();cu=ci.attributes;for(cv=0,cw=cu.length-1;cv<=cw;cv++){cx=cu.item(cv).name.toLowerCase();ct.set_Item(cx,(cy=cu.item(cv).nodeValue,cy===""?cx:cy.toLowerCase()));!cs.Add(cx)?c.warn("Hole mapped twice",cx):void 0;}for(cz=0,cA=ci.childNodes.length-1;cz<=cA;cz++){cB=ci.childNodes[cz];bT.Equals(cB.nodeType,m.ELEMENT_NODE)?!cs.Add(cB.nodeName.toLowerCase())?c.warn("Hole filled twice",cp):void 0:void 0;}cC=ci.childNodes.length===1&&bT.Equals(ci.firstChild.nodeType,m.TEXT_NODE);if(cC){cl=b$(cr,ci.firstChild.textContent);((function(cH){return function(cI){if(cI!=null)cH(cI.$0);};}((cm=function(cH){return function(cI){return cH.Add(cI);};}(cs),cn=function(){},function(cH){return cn(cm(cH));})))(cl));}b_(cr,cs);if(!cC){for(cD=0,cE=ci.childNodes.length-1;cD<=cE;cD++){cF=ci.childNodes[cD];bT.Equals(cF.nodeType,m.ELEMENT_NODE)?cF.hasAttributes()?b9(cr,cF):cd(cr,cF):void 0;}}b8(cr,ct);(((function(cH){var cI;cI=function(cJ,cK){return ca(cH,cJ,cK);};return function(cJ){return function(cK){return cI(cJ,cK);};};}(cr))(ci.parentNode))(ci));ci.parentNode.removeChild(ci);}case 1:if(cj!==null){cG=cj.nextSibling;if(bT.Equals(cj.nodeType,m.TEXT_NODE))b7(cj);else if(bT.Equals(cj.nodeType,m.ELEMENT_NODE))cf(cj);ch=1;ci=ci;cj=cG;}else return null;}}function cd(ch,ci){var cj,cl,cm;function ck(cn,co){var cp,cq,cr;if(cl==="title"&&ci.hasChildNodes()){cp=d.parseHTML(ci.textContent);ci.removeChild(ci.firstChild);for(cq=0,cr=cp.length-1;cq<=cr;cq++)ci.appendChild(bL.get(cp,cq));}else null;cf(ci);return ca(ci,cn,co);}cl=ci.nodeName.toLowerCase();J.IterSelector(ch,"[ws-attr-holes]",function(cn){var co,cp,cq,cr;co=bN.SplitChars(cn.getAttribute("ws-attr-holes"),[32],1);for(cp=0,cq=co.length-1;cp<=cq;cp++){cr=bL.get(co,cp);cn.setAttribute(cr,new o("\\${"+cl+"}","ig")[p.replace](cn.getAttribute(cr),ci.textContent));}});cm=ch.querySelector("[ws-hole="+cl+"]");if(bT.Equals(cm,null)){cj=ch.querySelector("[ws-replace="+cl+"]");return bT.Equals(cj,null)?null:(ck(cj.parentNode,cj),void cj.parentNode.removeChild(cj));}else{while(cm.hasChildNodes())cm.removeChild(cm.lastChild);cm.removeAttribute("ws-hole");return ck(cm,null);}}function ce(ch){return cc(0,ch);}function cf(ch){var ci,cj;if(bN.StartsWith(ch.nodeName.toLowerCase(),"ws-")&&!ch.hasAttribute("ws-template"))ce(ch);else{b6(ch);ci=ch.getAttribute("ws-template");if(ci===null){cj=ch.getAttribute("ws-children-template");if(cj===null)cg(ch,ch.firstChild);else{ch.removeAttribute("ws-children-template");bq.PrepareTemplate(b3,{$:1,$0:cj},function(){return J.ChildrenArray(ch);});while(ch.hasChildNodes())ch.removeChild(ch.lastChild);}}else bq.PrepareSingleTemplate(b3,{$:1,$0:ci},ch);}}function cg(ch,ci){return cc(1,ch,ci);}b6=function(ch){var cj,ck,cl,cm,cn,co,cp;function ci(cq){var cr;cr=ch.getAttribute(cq);cr===null?void 0:ch.setAttribute(cq,cr.toLowerCase());}cj=ch.attributes;ck=[];cl=[];cm=[];for(cn=0,co=cj.length-1;cn<=co;cn++){cp=cj.item(cn);bN.StartsWith(cp.nodeName,"ws-on")&&cp.nodeName!=="ws-onafterrender"&&cp.nodeName!=="ws-on"?(ck.push(cp.nodeName),cl.push(b2.string(cp.nodeName,{$:1,$0:"ws-on".length},null)+":"+cp.nodeValue.toLowerCase())):!bN.StartsWith(cp.nodeName,"ws-")&&(new o(bp.TextHoleRE())).test(cp.nodeValue)?(cp.nodeValue=new o(bp.TextHoleRE(),"g")[p.replace](cp.nodeValue,function(cq,cr){return"${"+cr.toLowerCase()+"}";}),cm.push(cp.nodeName)):void 0;}!(cl.length==0)?ch.setAttribute("ws-on",bN.concat(" ",cl)):void 0;!(cm.length==0)?ch.setAttribute("ws-attr-holes",bN.concat(" ",cm)):void 0;ci("ws-hole");ci("ws-replace");ci("ws-attr");ci("ws-onafterrender");ci("ws-var");bL.iter(function(cq){ch.removeAttribute(cq);},ck);};b7=function(ch){var ci,cj,ck,cl,cm,cn;ci=null;cj=0;cl=ch.textContent;cm=new o(bp.TextHoleRE(),"g");while(ci=cm.exec(cl),ci!==null){ch.parentNode.insertBefore(e.createTextNode(b2.string(cl,{$:1,$0:cj},{$:1,$0:cm.lastIndex-bL.get(ci,0).length-1})),ch);cj=cm.lastIndex;cn=e.createElement("span");cn.setAttribute("ws-replace",bL.get(ci,1).toLowerCase());ch.parentNode.insertBefore(cn,ch);}cm.lastIndex=0;ch.textContent=b2.string(cl,{$:1,$0:cj},null);};b8=function(ch,ci){function cj(ck){J.IterSelector(ch,"["+ck+"]",function(cl){var cm,cn;cm=(cn=null,[ci.TryGetValue(cl.getAttribute(ck).toLowerCase(),{get:function(){return cn;},set:function(co){cn=co;}}),cn]);cm[0]?cl.setAttribute(ck,cm[1]):void 0;});}cj("ws-hole");cj("ws-replace");cj("ws-attr");cj("ws-onafterrender");cj("ws-var");J.IterSelector(ch,"[ws-on]",function(ck){ck.setAttribute("ws-on",bN.concat(" ",bL.map(function(cl){var cm,cn,co;cm=bN.SplitChars(cl,[58],1);cn=(co=null,[ci.TryGetValue(bL.get(cm,1),{get:function(){return co;},set:function(cp){co=cp;}}),co]);return cn[0]?bL.get(cm,0)+":"+cn[1]:cl;},bN.SplitChars(ck.getAttribute("ws-on"),[32],1))));});return J.IterSelector(ch,"[ws-attr-holes]",function(ck){var cl,cm,cn;cl=bN.SplitChars(ck.getAttribute("ws-attr-holes"),[32],1);for(cm=0,cn=cl.length-1;cm<=cn;cm++)(function(){var co,cp;co=bL.get(cl,cm);return ck.setAttribute(co,((cp=function(cq,cr){var cs;cs=bY.KeyValue(cr);return new o("\\${"+cs[0]+"}","ig")[p.replace](cq,"${"+cs[1]+"}");},(bS.Curried3(bR.fold))(cp))(ck.getAttribute(co)))(ci));}());});};b9=function(ch,ci){var cj,ck,cl,cm,cn;b6(ci);cj=ci.nodeName.toLowerCase();ck=ch.querySelector("[ws-attr="+cj+"]");if(bT.Equals(ck,null))return c.warn("Filling non-existent attr hole",cj);else{ck.removeAttribute("ws-attr");for(cl=0,cm=ci.attributes.length-1;cl<=cm;cl++){cn=ci.attributes.item(cl);cn.name==="class"&&ck.hasAttribute("class")?ck.setAttribute("class",ck.getAttribute("class")+" "+cn.nodeValue):ck.setAttribute(cn.name,cn.nodeValue);}return;}};b_=function(ch,ci){function cj(ck){J.IterSelector(ch,"["+ck+"]",function(cl){if(!ci.Contains(cl.getAttribute(ck)))cl.removeAttribute(ck);});}cj("ws-attr");cj("ws-onafterrender");cj("ws-var");J.IterSelector(ch,"[ws-hole]",function(ck){if(!ci.Contains(ck.getAttribute("ws-hole"))){ck.removeAttribute("ws-hole");while(ck.hasChildNodes())ck.removeChild(ck.lastChild);}});J.IterSelector(ch,"[ws-replace]",function(ck){if(!ci.Contains(ck.getAttribute("ws-replace")))ck.parentNode.removeChild(ck);});J.IterSelector(ch,"[ws-on]",function(ck){ck.setAttribute("ws-on",bN.concat(" ",bL.filter(function(cl){return ci.Contains(bL.get(bN.SplitChars(cl,[58],1),1));},bN.SplitChars(ck.getAttribute("ws-on"),[32],1))));});return J.IterSelector(ch,"[ws-attr-holes]",function(ck){var cl,cm,cn,co;cl=bN.SplitChars(ck.getAttribute("ws-attr-holes"),[32],1);for(cm=0,cn=cl.length-1;cm<=cn;cm++){co=bL.get(cl,cm);ck.setAttribute(co,new o(bp.TextHoleRE(),"g")[p.replace](ck.getAttribute(co),function(cp,cq){return ci.Contains(cq)?cp:"";}));}});};b$=function(ch,ci){var cj;cj=ch.querySelector("[ws-replace]");return bT.Equals(cj,null)?(c.warn("Filling non-existent text hole",b4),null):(cj.parentNode.replaceChild(new q(ci),cj),{$:1,$0:cj.getAttribute("ws-replace")});};ca=function(ch,ci,cj){while(true)if(ch.hasChildNodes())cj=ci.insertBefore(ch.lastChild,cj);else return null;};cb=bq.FakeRoot(b5);bp.LoadedTemplates().set_Item(bq.ComposeName(b3,b4),cb);bL.length(b5)>0?cg(cb,bL.get(b5,0)):void 0;};bq.ComposeName=function(b3,b4){return(b3+"/"+(b4==null?"":b4.$0)).toLowerCase();};bq.PrepareSingleTemplate=function(b3,b4,b5){var b6,b7,b8;b5.removeAttribute("ws-template");b6=b5.getAttribute("ws-replace");b6===null?void 0:(b5.removeAttribute("ws-replace"),b7=b5.parentNode,bT.Equals(b7,null)?void 0:(b8=e.createElement(b5.tagName),b8.setAttribute("ws-replace",b6),b7.replaceChild(b8,b5)));bq.PrepareTemplateStrict(b3,b4,[b5]);};bq.FakeRoot=function(b3){var b4,b5,b6;b4=e.createElement("div");for(b5=0,b6=b3.length-1;b5<=b6;b5++)b4.appendChild(bL.get(b3,b5));return b4;};bq.ChildrenTemplate=function(b3,b4){var b5,b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg;ca=[];cb=[];cc=[];cd=[];ce=new b0.New$5();cf=bM.Get(b4);try{while(cf.MoveNext()){cg=cf.Current();ce.set_Item(cg.$0,cg);}}finally{if("Dispose"in cf)cf.Dispose();}b5=J.ChildrenArray(b3);b6=function(ch,ci){var cj,ck,cl;cj=bf.Insert(ch,ci);cb.push(bf.Updates(cj));cc.push([ch,cj]);ck=bS.GetOptional(cj.OnAfterRender);return ck==null?null:(cl=ck.$0,void cd.push(function(){cl(ch);}));};b7=function(ch){var ci,cj;ci=(cj=null,[ce.TryGetValue(ch,{get:function(){return cj;},set:function(ck){cj=ck;}}),cj]);return ci[0]?ci[1].$==0?{$:1,$0:ci[1].$1}:ci[1].$==1?{$:1,$0:bq.TextNode(ci[1].$1)}:ci[1].$==2?{$:1,$0:bq.TextView(ci[1].$1)}:ci[1].$==6?{$:1,$0:bq.TextView(ci[1].$1.RView())}:ci[1].$==7?{$:1,$0:bq.TextView(Q.Map(b,ci[1].$1.RView()))}:ci[1].$==8?{$:1,$0:bq.TextView(Q.Map(function(ck){return ck.get_Input();},ci[1].$1.RView()))}:ci[1].$==9?{$:1,$0:bq.TextView(Q.Map(b,ci[1].$1.RView()))}:ci[1].$==10?{$:1,$0:bq.TextView(Q.Map(function(ck){return ck.get_Input();},ci[1].$1.RView()))}:ci[1].$==11?{$:1,$0:bq.TextView(Q.Map(b,ci[1].$1.RView()))}:(c.warn("Content hole filled with attribute data",ch),null):null;};J.IterSelector(b3,"[ws-hole]",function(ch){var ci,cj,ck;ck=ch.getAttribute("ws-hole");ch.removeAttribute("ws-hole");while(ch.hasChildNodes())ch.removeChild(ch.lastChild);ci=b7(ck);ci!=null&&ci.$==1?(cj=ci.$0,bp.LinkElement(ch,cj.docNode),ca.push(bk.New(bf.Empty(ch),cj.docNode,null,ch,z.Int(),null)),cb.push(cj.updates)):void 0;});J.IterSelector(b3,"[ws-replace]",function(ch){var ci,cj,ck,cl,cm,cn;ci=b7(ch.getAttribute("ws-replace"));ci!=null&&ci.$==1?(cj=ci.$0,ck=ch.parentNode,cl=e.createTextNode(""),ck.replaceChild(cl,ch),cm=bp.InsertBeforeDelim(cl,cj.docNode),cn=bL.tryFindIndex(function(co){return ch===co;},b5),cn==null?void 0:bL.set(b5,cn.$0,cj.docNode),ca.push(bk.New(bf.Empty(ck),cj.docNode,{$:1,$0:[cm,cl]},ck,z.Int(),null)),cb.push(cj.updates)):void 0;});J.IterSelector(b3,"[ws-attr]",function(ch){var ci,cj,ck;ci=ch.getAttribute("ws-attr");ch.removeAttribute("ws-attr");cj=(ck=null,[ce.TryGetValue(ci,{get:function(){return ck;},set:function(cl){ck=cl;}}),ck]);cj[0]?cj[1].$==3?b6(ch,cj[1].$1):c.warn("Attribute hole filled with non-attribute data",ci):void 0;});J.IterSelector(b3,"[ws-on]",function(ch){b6(ch,bb.Concat(bL.choose(function(ci){var cj,ck,cl;cj=bN.SplitChars(ci,[58],1);ck=(cl=null,[ce.TryGetValue(bL.get(cj,1),{get:function(){return cl;},set:function(cm){cl=cm;}}),cl]);return ck[0]?ck[1].$==4?{$:1,$0:bh.Handler(bL.get(cj,0),ck[1].$1)}:(c.warn("Event hole on"+bL.get(cj,0)+" filled with non-event data",bL.get(cj,1)),null):null;},bN.SplitChars(ch.getAttribute("ws-on"),[32],1))));ch.removeAttribute("ws-on");});J.IterSelector(b3,"[ws-onafterrender]",function(ch){var ci,cj,ck;ci=ch.getAttribute("ws-onafterrender");cj=(ck=null,[ce.TryGetValue(ci,{get:function(){return ck;},set:function(cl){ck=cl;}}),ck]);cj[0]?cj[1].$==5?(ch.removeAttribute("ws-onafterrender"),b6(ch,bh.OnAfterRender(cj[1].$1))):c.warn("onafterrender hole filled with non-onafterrender data",ci):void 0;});J.IterSelector(b3,"[ws-var]",function(ch){var ci,cj,ck;ci=ch.getAttribute("ws-var");ch.removeAttribute("ws-var");cj=(ck=null,[ce.TryGetValue(ci,{get:function(){return ck;},set:function(cl){ck=cl;}}),ck]);cj[0]?cj[1].$==6?b6(ch,bh.Value(cj[1].$1)):cj[1].$==7?b6(ch,bh.Checked(cj[1].$1)):cj[1].$==8?b6(ch,bh.IntValue(cj[1].$1)):cj[1].$==9?b6(ch,bh.IntValueUnchecked(cj[1].$1)):cj[1].$==10?b6(ch,bh.FloatValue(cj[1].$1)):cj[1].$==11?b6(ch,bh.FloatValueUnchecked(cj[1].$1)):c.warn("Var hole filled with non-Var data",ci):void 0;});J.IterSelector(b3,"[ws-attr-holes]",function(ch){var ci,cj,ck,cl;ci=new o(bp.TextHoleRE(),"g");cj=bN.SplitChars(ch.getAttribute("ws-attr-holes"),[32],1);ch.removeAttribute("ws-attr-holes");for(ck=0,cl=cj.length-1;ck<=cl;ck++)(function(){var cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy;cv=bL.get(cj,ck);cw=ch.getAttribute(cv);cm=null;cn=0;cx=[];while(cm=ci.exec(cw),cm!==null){cy=b2.string(cw,{$:1,$0:cn},{$:1,$0:ci.lastIndex-bL.get(cm,0).length-1});cn=ci.lastIndex;cx.push([cy,bL.get(cm,1)]);}cp=b2.string(cw,{$:1,$0:cn},null);ci.lastIndex=0;cq=bL.foldBack(function(cz,cA){return(function(cB){var cC,cD;cC=cB[0];cD=cB[1];return function(cE){var cF,cG,cH,cI,cJ;cF=cE[0];cG=cE[1];cH=(cI=(cJ=null,[ce.TryGetValue(cD,{get:function(){return cJ;},set:function(cK){cJ=cK;}}),cJ]),cI[0]?cI[1].$==1?{$:0,$0:cI[1].$1}:cI[1].$==2?{$:1,$0:cI[1].$1}:cI[1].$==6?{$:1,$0:cI[1].$1.RView()}:cI[1].$==7?{$:1,$0:Q.Map(b,cI[1].$1.RView())}:cI[1].$==8?{$:1,$0:Q.Map(function(cK){return cK.get_Input();},cI[1].$1.RView())}:cI[1].$==9?{$:1,$0:Q.Map(b,cI[1].$1.RView())}:cI[1].$==10?{$:1,$0:Q.Map(function(cK){return cK.get_Input();},cI[1].$1.RView())}:cI[1].$==11?{$:1,$0:Q.Map(b,cI[1].$1.RView())}:(c.warn("Attribute value hole filled with non-text data",cD),{$:0,$0:""}):{$:0,$0:""});return cH.$==1?[cC,new bK.T({$:1,$0:cF===""?cH.$0:Q.Map(function(cK){return cK+cF;},cH.$0),$1:cG})]:[cC+cH.$0+cF,cG];};}(cz))(cA);},cx,[cp,bK.T.Empty]);return b6(ch,cq[1].$==1?cq[1].$1.$==1?cq[1].$1.$1.$==1?cq[1].$1.$1.$1.$==0?(cr=cq[0],bh.Dynamic(cv,Q.Map3(function(cz,cA,cB){return cr+cz+cA+cB;},cq[1].$0,cq[1].$1.$0,cq[1].$1.$1.$0))):(cs=cq[0],bh.Dynamic(cv,Q.Map(function(cz){return cs+bN.concat("",cz);},Q.Sequence(cq[1])))):(ct=cq[0],bh.Dynamic(cv,Q.Map2(function(cz,cA){return ct+cz+cA;},cq[1].$0,cq[1].$1.$0))):cq[0]===""?bh.Dynamic(cv,cq[1].$0):(cu=cq[0],bh.Dynamic(cv,Q.Map(function(cz){return cu+cz;},cq[1].$0))):bb.Create(cv,cq[0]));}());});b8=bS.DeleteEmptyFields({Els:b5,Dirty:true,Holes:ca,Attrs:cc,Render:(b9=cd.length==0?null:{$:1,$0:function(ch){bL.iter(function(ci){ci(ch);},cd);}},b9?b9.$0:void 0)},["Render"]);b_=w.TreeReduce(Q.Const(),Q.Map2Unit,cb);return b5&&bL.length(b5)===1&&(bL.get(b5,0)instanceof m&&(bT.Equals(bL.get(b5,0).nodeType,m.ELEMENT_NODE)&&(b$=bL.get(b5,0),true)))?br.TreeNode(b8,b_):bq.Mk({$:6,$0:b8},b_);};bq.Template=function(b3,b4){return bq.ChildrenTemplate(bq.FakeRoot(b3),b4);};bq.TextView=function(b3){var b4;b4=bp.CreateTextNode();return bq.Mk({$:4,$0:b4},Q.Map(function(b5){bp.UpdateTextNode(b4,b5);},b3));};bq.RunReplaceById=function(b3,b4){var b5;b5=J.Doc().getElementById(b3);bT.Equals(b5,null)?bY.FailWith("invalid id: "+b3):b4.ReplaceInDom(b5);};bq.RunById=function(b3,b4){var b5;b5=J.Doc().getElementById(b3);bT.Equals(b5,null)?bY.FailWith("invalid id: "+b3):bq.Run(b5,b4);};bq.Run=function(b3,b4){var b5;b5=b4.docNode;bp.LinkElement(b3,b5);Q.Sink(E.StartProcessor(bp.PerformAnimatedUpdate(bp.CreateRunState(b3,b5),b5)),b4.updates);};bq.RunPrependById=function(b3,b4){var b5;b5=J.Doc().getElementById(b3);bT.Equals(b5,null)?bY.FailWith("invalid id: "+b3):bq.RunPrepend(b5,b4);};bq.RunPrepend=function(b3,b4){var b5;b5=e.createTextNode("");b3.insertBefore(b5,b3.firstChild);bq.RunBefore(b5,b4);};bq.RunAppendById=function(b3,b4){var b5;b5=J.Doc().getElementById(b3);bT.Equals(b5,null)?bY.FailWith("invalid id: "+b3):bq.RunAppend(b5,b4);};bq.RunAppend=function(b3,b4){var b5;b5=e.createTextNode("");b3.appendChild(b5);bq.RunBefore(b5,b4);};bq.RunAfterById=function(b3,b4){var b5;b5=J.Doc().getElementById(b3);bT.Equals(b5,null)?bY.FailWith("invalid id: "+b3):bq.RunAfter(b5,b4);};bq.RunAfter=function(b3,b4){var b5;b5=e.createTextNode("");b3.parentNode.insertBefore(b5,b3.nextSibling);bq.RunBetween(b3,b5,b4);};bq.RunBeforeById=function(b3,b4){var b5;b5=J.Doc().getElementById(b3);bT.Equals(b5,null)?bY.FailWith("invalid id: "+b3):bq.RunBefore(b5,b4);};bq.RunBefore=function(b3,b4){var b5;b5=e.createTextNode("");b3.parentNode.insertBefore(b5,b3);bq.RunBetween(b5,b3,b4);};bq.RunBetween=function(b3,b4,b5){bp.LinkPrevElement(b4,b5.docNode);Q.Sink(E.StartProcessor(bp.PerformAnimatedUpdate(bp.CreateDelimitedRunState(b3,b4,b5.docNode),b5.docNode)),b5.updates);};bq.Async=function(b3){return bq.EmbedView(Q.MapAsync(g,Q.Const(b3)));};bq.BindView=function(b3,b4){return bq.EmbedView(Q.Map(b3,b4));};bq.EmbedView=function(b3){var b4;b4=bp.CreateEmbedNode();return bq.Mk({$:2,$0:b4},Q.Map(function(){},Q.Bind(function(b5){bp.UpdateEmbedNode(b4,b5.docNode);return b5.updates;},b3)));};bq.Static=function(b3){return br.New(b3,bf.EmptyAttr(),bq.Empty());};bq.Mk=function(b3,b4){return new bq.New(b3,b4);};bq.New=bS.Ctor(function(b3,b4){this.docNode=b3;this.updates=b4;},bq);br=v.Elt=bS.Class({AddClass:function(b3){return this.elt.className+=" "+b3;},ClearHoles:function(){var b3;b3=this.docNode$1;b3.$==6?b3.$0.Holes=[]:void 0;},AddHole:function(b3){var b4;b4=this.docNode$1;b4.$==6?b4.$0.Holes.push(b3):void 0;},SetStyle:function(b3,b4){this.elt.style[b3]=b4;},HasClass:function(b3){return(new o("(\\s|^)"+b3+"(\\s|$)")).test(this.elt.className);},RemoveClass:function(b3){this.elt.className=this.elt.className.replace(new o("(?:(\\s|^)"+b3+")+(\\s|$)","g"),"$1");},GetProperty:function(b3){return this.elt[b3];},SetProperty:function(b3,b4){this.elt[b3]=b4;},RemoveAttribute:function(b3){this.elt.removeAttribute(b3);},HasAttribute:function(b3){return this.elt.hasAttribute(b3);},GetAttribute:function(b3){return this.elt.getAttribute(b3);},SetAttribute:function(b3,b4){this.elt.setAttribute(b3,b4);},SetText:function(b3){var b4;b4=this.docNode$1;b4.$==1?b4.$0.Children=bj.EmptyDoc:b4.$==6?(b4.$0.Els=[],this.ClearHoles()):bY.FailWith("Invalid docNode in Elt");P.Set(this.rvUpdates,Q.Const());this.elt.textContent=b3;},GetText:function(){return this.elt.textContent;},SetValue:function(b3){this.elt.value=b3;},GetValue:function(){return this.elt.value;},Id:function(){return this.elt.id;},Html:function(){return this.elt.outerHTML;},Clear:function(){var b3;b3=this.docNode$1;b3.$==1?b3.$0.Children=bj.EmptyDoc:b3.$==6?(b3.$0.Els=[],this.ClearHoles()):bY.FailWith("Invalid docNode in Elt");P.Set(this.rvUpdates,Q.Const());while(this.elt.hasChildNodes())this.elt.removeChild(this.elt.firstChild);},Prepend:function(b3){var b4,b5,b6,b7,b8;b4=this.docNode$1;b4.$==1?(b5=b4.$0,b5.Children={$:0,$0:b3.docNode,$1:b5.Children},bp.InsertDoc(this.elt,b3.docNode,(b6=this.elt.firstChild,bT.Equals(b6,null)?null:b6))):b4.$==6?(b7=this.elt.insertBefore(e.createTextNode(""),this.elt.firstChild),b8=bp.InsertBeforeDelim(b7,b3.docNode),this.AddHole(bk.New(bf.Empty(this.elt),b3.docNode,{$:1,$0:[b8,b7]},this.elt,z.Int(),null))):bY.FailWith("Invalid docNode in Elt");P.Set(this.rvUpdates,Q.Map2Unit(this.rvUpdates.c,b3.updates));},Append:function(b3){var b4,b5,b6,b7;b4=this.docNode$1;b4.$==1?(b5=b4.$0,b5.Children={$:0,$0:b5.Children,$1:b3.docNode},bp.InsertDoc(this.elt,b3.docNode,null)):b4.$==6?(b6=this.elt.appendChild(e.createTextNode("")),b7=bp.InsertBeforeDelim(b6,b3.docNode),this.AddHole(bk.New(bf.Empty(this.elt),b3.docNode,{$:1,$0:[b7,b6]},this.elt,z.Int(),null))):bY.FailWith("Invalid docNode in Elt");P.Set(this.rvUpdates,Q.Map2Unit(this.rvUpdates.c,b3.updates));},ToUpdater:function(){var b3,b4;return new bs.New((b3=this.docNode$1,b3.$==1?bS.DeleteEmptyFields({Els:[this.elt],Dirty:true,Holes:[],Attrs:[[this.elt,b3.$0.Attr]],Render:(b4=null,b4?b4.$0:void 0)},["Render"]):b3.$==6?b3.$0:bY.FailWith("Invalid docNode in Elt")),this.updates$1,this.elt,this.rvUpdates,P.Create$1([]));},OnAfterRenderView:function(b3,b4){var b5,b6;b5=this;b6=z.Id();this.Append(bq.BindView(function(b7){b5.elt[b6]=b7;return bq.Empty();},b3));return this.OnAfterRender(function(b7){b4(b7,b7[b6]);});},OnAfterRender:function(b3){var b4,b5,b6,b7,b8,b9,b_;b4=this.docNode$1;b4.$==1?(b5=b4.$0,bS.SetOptional(b5,"Render",(b6=bS.GetOptional(b5.Render),b6!=null&&b6.$==1?(b7=b6.$0,{$:1,$0:function(b$){b7(b$);b3(b$);}}):{$:1,$0:b3}))):b4.$==6?(b8=b4.$0,bS.SetOptional(b8,"Render",(b9=bS.GetOptional(b8.Render),b9!=null&&b9.$==1?(b_=b9.$0,{$:1,$0:function(b$){b_(b$);b3(b$);}}):{$:1,$0:b3}))):bY.FailWith("Invalid docNode in Elt");return this;},onView:function(b3,b4,b5){var b6;b6=b5(this.elt);this.elt.addEventListener(b3,function(b7){return Q.Get(b6(b7),b4);},false);return this;},on:function(b3,b4){this.elt.addEventListener(b3,function(b5){return b4(b5.target,b5);},false);return this;}},bq,br);br.TreeNode=function(b3,b4){var b5,b6,b7,b8;b5=P.Create$1(b4);return new br.New$1({$:6,$0:b3},Q.Bind((b6=(b7=bL.map((b8=function(b9){return b9[1];},function(b9){return bf.Updates(b8(b9));}),b3.Attrs),w.TreeReduce(Q.Const(),Q.Map2Unit,b7)),function(b9){return Q.Map2Unit(b6,b9);}),b5.v),bL.get(b3.Els,0),b5);};br.New=function(b3,b4,b5){var b6,b7,b8;b6=bp.CreateElemNode(b3,b4,b5.docNode);b7=P.Create$1(b5.updates);return new br.New$1({$:1,$0:b6},Q.Bind((b8=bf.Updates(b6.Attr),function(b9){return Q.Map2Unit(b8,b9);}),b7.v),b3,b7);};br.New$1=bS.Ctor(function(b3,b4,b5,b6){bq.New.call(this,b3,b4);this.docNode$1=b3;this.updates$1=b4;this.elt=b5;this.rvUpdates=b6;},br);bs=bc.EltUpdater=bS.Class({RemoveAllUpdated:function(){this.treeNode.Holes=this.origHoles;P.Set(this.holeUpdates,[]);},RemoveUpdated:function(b3){var b4,b5,b6;b4=b3.docNode;b4.$==1?(b5=b4.$0.ElKey,this.treeNode.Holes=bL.filter(function(b7){return b7.ElKey!==b5;},this.treeNode.Holes),P.Set(this.holeUpdates,(b6=function(b7){return b7===b5?false:true;},bL.filter(function(b7){return b6(b7[0]);},this.holeUpdates.c)))):bY.FailWith("DocUpdater.RemoveUpdated expects a single element node");},AddUpdated:function(b3){var b4,b5,b6;b4=b3.docNode;b4.$==1?(b5=b4.$0,this.treeNode.Holes=this.treeNode.Holes.concat([b5]),b6=this.holeUpdates.c,b6.push([b5.ElKey,b3.updates]),P.Set(this.holeUpdates,b6)):bY.FailWith("DocUpdater.AddUpdated expects a single element node");},ClearHoles:function(){this.origHoles=[];this.treeNode.Holes=[];P.Set(this.holeUpdates,[]);},AddHole:function(b3){this.origHoles.push(b3);this.treeNode.Holes=this.treeNode.Holes.concat([b3]);}},br,bs);bs.New=bS.Ctor(function(b3,b4,b5,b6,b7){var b8,b9,b_,b$;br.New$1.call(this,{$:6,$0:b3},Q.Map2Unit(b4,Q.BindInner((b8=(b9=function(ca){return ca[1];},function(ca){return bL.map(b9,ca);}),(b_=(b$=Q.Const(),function(ca){return w.TreeReduce(b$,Q.Map2Unit,ca);}),function(ca){return b_(b8(ca));})),b7.v)),b5,b6);this.treeNode=b3;this.holeUpdates=b7;this.origHoles=this.treeNode.Holes;},bs);bt.$cctor=bS.Cctor(function(){bt.LoadedTemplates=new b0.New$5();bt.TextHoleRE="\\${([^}]+)}";bt.$cctor=window.ignore;});bu=v.Flow=bS.Class({get_Render:function(){return this.render;}},null,bu);bu.New=bS.Ctor(function(b3){bu.New$1.call(this,function(b4){return function(b5){return P.Set(b4,b3(b5));};});},bu);bu.New$1=bS.Ctor(function(b3){this.render=b3;},bu);bu.get_Do=function(){return new bv.New();};bu.Static=function(b3){return new bu.New$1(function(b4){return function(b5){P.Set(b4,b3);return b5();};});};bu.Define=function(b3){return new bu.New(function(b4){return b3(function(b5){b4(b5);});});};bu.Embed=function(b3){var b4;b4=P.Create$1(bq.Empty());((b3.get_Render())(b4))(function(b5){});return bq.EmbedView(b4.v);};bu.Return=function(b3){return new bu.New$1(function(){return function(b4){return b4(b3);};});};bu.Bind=function(b3,b4){return new bu.New$1(function(b5){return function(b6){return((b3.get_Render())(b5))(function(b7){((b4(b7).get_Render())(b5))(b6);});};});};bu.Map=function(b3,b4){return new bu.New$1(function(b5){return function(b6){return((b4.get_Render())(b5))(function(b7){b6(b3(b7));});};});};bv=v.FlowBuilder=bS.Class({ReturnFrom:g,Return:function(b3){return bu.Return(b3);},Bind:function(b3,b4){return bu.Bind(b3,b4);}},null,bv);bv.New=bS.Ctor(function(){},bv);bx=bw.attr=bS.Class({},null,bx);bx.New=bS.Ctor(function(){},bx);by.Append=function(b3,b4){return{$:0,$0:H.Append(b3.$0,b4.$0),$1:bV.FoldBack(function(b5,b6,b7){return b7.Add(b5,b6);},b3.$1,b4.$1)};};by.FromList=function(b3,b4){return{$:0,$0:H.FromArray(bL.ofList(b3)),$1:b4};};by.ToList=function(b3){return[bK.ofArray(H.ToArray(b3.$0)),b3.$1];};by.SameHash=function(b3,b4){return by.NoHash(b3)===by.NoHash(b4);};by.MakeHash=function(b3){var b4,b5;b4=b3.$1;b5=bN.concat("/",bL.map(function(b6){return s(b6);},H.ToArray(b3.$0)));return b4.get_IsEmpty()?b5:b5+"?"+bN.concat("&",bR.map(function(b6){var b7;b7=bY.KeyValue(b6);return s(b7[0])+"="+s(b7[1]);},b4));};by.ParseHash=function(b3){var b4,b5,b6,b7;b4=by.NoHash(b3);b5=(b6=b4.indexOf(b.fromCharCode(63)),b6===-1?[b4,""]:[b2.string(b4,null,{$:1,$0:b6-1}),b2.string(b4,{$:1,$0:b6+1},null)]);b7=b5[0];return{$:0,$0:H.FromArray(b7===""?[]:bL.map(function(b8){return r(b8);},bN.SplitChars(b7,[47],0))),$1:bV.OfArray(bL.map(function(b8){var b9;b9=b8.indexOf(b.fromCharCode(61));return b9===-1?[r(b8),""]:[r(b2.string(b8,null,{$:1,$0:b9-1})),r(b2.string(b8,{$:1,$0:b9+1},null))];},bN.SplitChars(b5[1],[38],0)))};};by.NoHash=function(b3){return bN.StartsWith(b3,"#")?b3.substring(1):b3;};bA.New=function(b3,b4,b5,b6){return{Bodies:b3,CurrentRoute:b4,CurrentSite:b5,Selection:b6};};bz.Install=function(b3,b4){var b5,b6,b7,b8,b9,b_,b$,ca,cb;function cc(cd){var ce;ce=b_(cd);ce.$==1?void 0:bz.OnGlobalRouteChange(b7,ce.$0,by.FromList(ce.$1,new bW.New([])));}b5=b4.$0;b6=bz.InstallMap({Des:function(cd){return by.FromList(cd[0],cd[1]);},Ser:by.ToList});b7=bA.New(void 0,b6,0,void 0);b8=(b9=function(cd,ce){var cf;cf=ce.$0;return ce.$1({UpdateRoute:function(cg){bz.OnInternalSiteUpdate(b7,cf,cd,cg);}});},L.Map(function(cd){return function(ce){return b9(cd,ce);};},b4.$1));b7.Bodies=bz.ComputeBodies(b8);b_=function(cd){return L.Lookup(b8,(by.ToList(cd))[0]);};b$=(ca=b_(b6.c),ca.$==0?(cb=ca.$0,(b7.CurrentSite=cb.RouteId,P.Create$1(cb.RouteValue))):P.Create$1(b5!=null&&b5.$==1?b5.$0:bY.FailWith("Site.Install fails on empty site")));b7.Selection=b$;Q.Sink(function(cd){bz.OnSelectSite(b7,b3(cd));},b$.v);cc(b6.c);Q.Sink(cc,b6.v);return b$;};bz.OnSelectSite=function(b3,b4){var b5;b5=b4.$0;b3.CurrentSite!==b5?(b3.CurrentSite=b5,b3.Bodies.get_Item(b5).OnSelect()):void 0;};bz.OnInternalSiteUpdate=function(b3,b4,b5,b6){if(b3.CurrentSite===b4)bz.SetCurrentRoute(b3,by.Append(by.FromList(b5,new bW.New([])),b6));};bz.OnGlobalRouteChange=function(b3,b4,b5){b3.CurrentSite!==b4.RouteId?(b3.CurrentSite=b4.RouteId,P.Set(b3.Selection,b4.RouteValue)):void 0;b4.OnRouteChanged(b5);};bz.SetCurrentRoute=function(b3,b4){if(!bT.Equals(b3.CurrentRoute.c,b4))P.Set(b3.CurrentRoute,b4);};bz.ComputeBodies=function(b3){var b4;b4=new b0.New$5();bL.iter(function(b5){b4.set_Item(b5.RouteId,b5);},L.ToArray(b3));return b4;};bz.MergeRouters=function(b3){var b4,b5,b6;b4=w.ofSeqNonCopying(b3);b5=L.Merge(bR.map(function(b7){return b7.$1;},b4));b6=bR.tryPick(function(b7){return b7.$0;},b4);return b5!=null&&b5.$==1?{$:0,$0:b6,$1:b5.$0}:bY.FailWith("Invalid Site.Merge: need more prefix disambiguation");};bz.DefineRoute=function(b3,b4,b5){var b6,b7,b8;b6=P.Create$1(b4);b7=z.Int();b8=b5({$:0,$0:b7},b6);return{$:0,$0:{$:1,$0:b8},$1:L.Leaf({$:0,$0:b7,$1:function(b9){Q.Sink(function(b_){b9.UpdateRoute(bz.DoLink(b3,b_));},b6.v);return{OnRouteChanged:function(b_){P.Set(b6,bz.DoRoute(b3,b_));},OnSelect:function(){b9.UpdateRoute(bz.DoLink(b3,b6.c));},RouteId:b7,RouteValue:b8};}})};};bz.DoLink=function(b3,b4){var b5;b5=b3.Ser(b4);return by.FromList(b5[0],b5[1]);};bz.DoRoute=function(b3,b4){return b3.Des(by.ToList(b4));};bz.InstallMap=function(b3){var b4,b5,b6,b7;function b8(b9){return b7(b5());}b4=function(b9,b_){return bT.Equals(b3.Ser(b9),b3.Ser(b_));};b5=function(){return b3.Des(by.ToList(by.ParseHash(window.location.hash)));};b6=P.Create$1(b5());b7=function(b9){if(!b4(b6.c,b9))P.Set(b6,b9);};window.onpopstate=b8;window.onhashchange=b8;Q.Sink(function(b9){var b_,b$;b_=by.MakeHash((b$=b3.Ser(b9),by.FromList(b$[0],b$[1])));!by.SameHash(window.location.hash,b_)?window.location.replace("#"+b_):void 0;},b6.v);return b6;};bB.Install=function(b3){return bz.InstallMap(b3);};bB.Create=function(b3,b4){var b5;return{Des:(b5=function(b6){return b6[0];},function(b6){return b4(b5(b6));}),Ser:function(b6){return[b3(b6),new bW.New([])];}};};bB.CreateWithQuery=function(b3,b4){return{Des:b4,Ser:b3};};bC.Route=function(b3,b4,b5){return bz.DefineRoute(b3,b4,b5);};bC.Prefix=function(b3,b4){return{$:0,$0:b4.$0,$1:L.Prefix(b3,b4.$1)};};bC.Merge=function(b3){return bz.MergeRouters(b3);};bC.Install=function(b3,b4){return bz.Install(b3,b4);};bC.Dir=function(b3,b4){return bC.Prefix(b3,bC.Merge(b4));};bE.New=function(b3,b4){return{Active:b3,PosV:b4};};bF.New=function(b3,b4,b5,b6){return{Active:b3,Left:b4,Middle:b5,Right:b6};};bG.get_MousePressed=function(){bD.ActivateButtonListener();return Q.Apply(Q.Apply(Q.Apply(Q.Const(bS.Curried3(function(b3,b4,b5){return b3||b4||b5;})),bD.MouseBtnSt$1().Left.v),bD.MouseBtnSt$1().Middle.v),bD.MouseBtnSt$1().Right.v);};bG.get_RightPressed=function(){bD.ActivateButtonListener();return bD.MouseBtnSt$1().Right.v;};bG.get_MiddlePressed=function(){bD.ActivateButtonListener();return bD.MouseBtnSt$1().Middle.v;};bG.get_LeftPressed=function(){bD.ActivateButtonListener();return bD.MouseBtnSt$1().Left.v;};bG.get_Position=function(){!bD.MousePosSt$1().Active?(e.addEventListener("mousemove",function(b3){P.Set(bD.MousePosSt$1().PosV,[b3.clientX,b3.clientY]);},false),bD.MousePosSt$1().Active=true):void 0;return bD.MousePosSt$1().PosV.v;};bH.New=function(b3,b4,b5){return{KeysPressed:b3,KeyListenerActive:b4,LastPressed:b5};};bI.IsPressed=function(b3){var b4;bD.ActivateKeyListener();return Q.Map((b4=function(b5){return b5===b3;},function(b5){return bK.exists(b4,b5);}),bD.KeyListenerState().KeysPressed.v);};bI.get_LastPressed=function(){bD.ActivateKeyListener();return bD.KeyListenerState().LastPressed.v;};bI.get_KeysPressed=function(){bD.ActivateKeyListener();return bD.KeyListenerState().KeysPressed.v;};bD.ActivateKeyListener=function(){bJ.$cctor();return bJ.ActivateKeyListener;};bD.KeyListenerState=function(){bJ.$cctor();return bJ.KeyListenerState;};bD.ActivateButtonListener=function(){bJ.$cctor();return bJ.ActivateButtonListener;};bD.MouseBtnSt$1=function(){bJ.$cctor();return bJ.MouseBtnSt;};bD.MousePosSt$1=function(){bJ.$cctor();return bJ.MousePosSt;};bJ.$cctor=bS.Cctor(function(){var b3;bJ.MousePosSt=bE.New(false,P.Create$1([0,0]));bJ.MouseBtnSt=bF.New(false,P.Create$1(false),P.Create$1(false),P.Create$1(false));bJ.ActivateButtonListener=(b3=function(b4,b5){var b6;b6=b4.button;return b6===0?P.Set(bD.MouseBtnSt$1().Left,b5):b6===1?P.Set(bD.MouseBtnSt$1().Middle,b5):b6===2?P.Set(bD.MouseBtnSt$1().Right,b5):null;},!bD.MouseBtnSt$1().Active?(bD.MouseBtnSt$1().Active=true,e.addEventListener("mousedown",function(b4){return b3(b4,true);},false),e.addEventListener("mouseup",function(b4){return b3(b4,false);},false)):null);bJ.KeyListenerState=bH.New(P.Create$1(bK.T.Empty),false,P.Create$1(-1));bJ.ActivateKeyListener=!bD.KeyListenerState().KeyListenerActive?(d(e).keydown(function(b4){var b5,b6;b5=b4.which;P.Set(bD.KeyListenerState().LastPressed,b5);b6=bD.KeyListenerState().KeysPressed.c;return!bK.exists(function(b7){return b7===b5;},b6)?P.Set(bD.KeyListenerState().KeysPressed,bK.append(b6,bK.ofArray([b5]))):null;}),void d(e).keyup(function(b4){var b5,b6;b5=b4.which;return P.Update(bD.KeyListenerState().KeysPressed,(b6=function(b7){return b7!==b5;},function(b7){return bK.filter(b6,b7);}));})):null;bJ.$cctor=window.ignore;});}());
